var t=Object.defineProperty,e=(e,i,n)=>((e,i,n)=>i in e?t(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n)(e,"symbol"!=typeof i?i+"":i,n);import{r as i,g as n}from"./phaser-CLYd3JIB.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const i of t)if("childList"===i.type)for(const t of i.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var s=i();let o=0;function r(){return o++}function a(t,e,i){let n=t;const s=(o=e,t=>function(t){let e=0;for(let i=0;i<=2;i++)for(let n=0;n<=2;n++)1===n&&1===i||t[n][i]===d.WALL&&e++;return e}(t)>=o?d.WALL:d.EMPTY);var o;for(let r=0;r<i;r++)n=y(n,((t,e)=>s(e)));return n}function h(t,e){const{x:i,y:n}=t,{x:s,y:o}=e,r=s-i,a=o-n;return Math.sqrt(a*a+r*r)}function l(t,e){return t+Math.random()*(e-t)}var c=(t=>(t[t.START=0]="START",t[t.END=1]="END",t[t.EMPTY=2]="EMPTY",t[t.REFUEL=3]="REFUEL",t))(c||{});function u(t,e){return t*(1-e)+Math.random()*t*e*2}var d=(t=>(t[t.WALL=0]="WALL",t[t.EMPTY=1]="EMPTY",t))(d||{});function g(t,e,i){let n=function(t,e){let i=function(t,e){let i=[];for(let n=0;n<t;n++){const t=[];for(let i=0;i<e;i++)t.push(0);i.push(t)}return i}(t,e);return i=y(i,(()=>Math.random()>.39?d.EMPTY:d.WALL)),i=a(i,4,2),i}(e,t);n=a(n,4,17);const s=function(t){const e=[],i=[],n=t.length,s=t[0].length-20,o=n-20,r=Math.floor(s/30),a=Math.floor(s/r);let c=null,u=.1;for(let d=0;d<r;d++){let t,n;const s=Math.floor(10+a*d+a/2);switch(d){case 0:t=0,n=Math.floor(15);break;case r-1:t=1,n=Math.floor(10+o);break;default:{n=Math.floor(10+o*Math.random());let e=h({x:s,y:n},c.coords);e>150&&(u=(u+e/300)/2,u=Math.min(u,1)),Math.random()<u?(t=3,u=.1):(t=2,u=(1+u)/2)}}const g={coords:{x:s,y:n},type:t,diameter:14*(Math.random()+.7)};if(e.push(g),d>0){const t={start:c,end:g,widthModifier:l(8,11),freqModifier:l(.1,.27),amplModifier:l(2,9)};i.push(t)}c=g}return{nodes:e,edges:i}}(n);n=function(t,e){const i=e.nodes;return y(t,((e,n)=>{for(let t=0;t<i.length;t++){const n=i[t];if(u(h(n.coords,e),.8)<n.diameter)return d.EMPTY}return t[e.y][e.x]}))}(n,s),n=function(t,e){let i=t;return e.edges.forEach((t=>{i=function(t,e){return y(t,((i,n)=>function(t,e,i){const{start:n,end:s,widthModifier:o,freqModifier:r,amplModifier:a}=e,h=s.coords.x-n.coords.x,l=s.coords.y-n.coords.y,c=Math.hypot(h,l);if(0===c)return i;const g=h/c,y=l/c,p=(t.x-n.coords.x)*g+(t.y-n.coords.y)*y,f=p;if(f<0||f>c)return i;const m=n.coords.x+g*p,b=n.coords.y+y*p,v=-y,x=g,P=(t.x-m)*v+(t.y-b)*x,w=Math.sin(f*r)*a;return u(Math.abs(P-w),.8)<o?d.EMPTY:i}(i,e,t[i.y][i.x])))}(i,t)})),i}(n,s),n=a(n,4,5);let o=0;n.forEach((t=>{t.forEach((t=>{0===t&&o++}))}));const c=function(t){const e=t.length,i=t[0].length,n=Array.from({length:e},(()=>Array(i).fill(!1))),s=[];for(let o=0;o<e;o++)for(let a=0;a<i;a++){if(t[o][a]!==d.WALL||n[o][a])continue;let h=0;for(let e=a;e<i&&t[o][e]===d.WALL&&!n[o][e];e++)h++;let l=0,c=!1;for(let i=o;i<e&&!c;i++){for(let e=a;e<a+h;e++)if(t[i][e]!==d.WALL||n[i][e]){c=!0;break}c||l++}for(let t=o;t<o+l;t++)for(let e=a;e<a+h;e++)n[t][e]=!0;s.push({id:r(),leftTop:{x:a,y:o},rightBottom:{x:a+h-1,y:o+l-1}})}return s}(n);console.log("original walls : "+o),console.log("optimised walls : "+c.length);const g=function(t){let e=t.filter((t=>{const e=t.rightBottom.x-t.leftTop.x+1,i=t.rightBottom.y-t.leftTop.y+1;return!(1===e&&1===i)})),i=!0;for(;i;){i=!1;const t=[],n=new Array(e.length).fill(!1);for(let s=0;s<e.length;s++){if(n[s])continue;const o=e[s];let a=!1;for(let h=s+1;h<e.length;h++){if(n[h])continue;const l=e[h];if(o.leftTop.y===l.leftTop.y&&o.rightBottom.y===l.rightBottom.y&&(o.rightBottom.x+1===l.leftTop.x||l.rightBottom.x+1===o.leftTop.x)){const e=Math.min(o.leftTop.x,l.leftTop.x),c=Math.max(o.rightBottom.x,l.rightBottom.x),u={id:r(),leftTop:{x:e,y:o.leftTop.y},rightBottom:{x:c,y:o.rightBottom.y}};t.push(u),n[s]=n[h]=!0,i=a=!0;break}if(o.leftTop.x===l.leftTop.x&&o.rightBottom.x===l.rightBottom.x&&(o.rightBottom.y+1===l.leftTop.y||l.rightBottom.y+1===o.leftTop.y)){const e=Math.min(o.leftTop.y,l.leftTop.y),c=Math.max(o.rightBottom.y,l.rightBottom.y),u={id:r(),leftTop:{x:o.leftTop.x,y:e},rightBottom:{x:o.rightBottom.x,y:c}};t.push(u),n[s]=n[h]=!0,i=a=!0;break}}a||n[s]||(t.push(o),n[s]=!0)}e=t}return e}(c);console.log("refined walls : "+c.length);let p=function(t,e,i,n){const s=Math.ceil(t/n),o=Math.ceil(e/n),a=Array(o).fill(null).map((()=>Array(s).fill(null)));for(let h=0;h<o;h++)for(let i=0;i<s;i++)a[h][i]={id:r(),leftX:i*n,rightX:Math.min((i+1)*n,t),topY:h*n,bottomY:Math.min((h+1)*n,e),blocks:[],neighbours:[]};for(const r of i){const t=r.leftTop.x,e=r.rightBottom.x,i=r.leftTop.y,h=r.rightBottom.y,l=Math.floor(t/n),c=Math.floor(e/n),u=Math.floor(i/n),d=Math.floor(h/n);for(let n=u;n<=d;n++)for(let t=l;t<=c;t++)n>=0&&n<o&&t>=0&&t<s&&a[n][t].blocks.push(r)}for(let r=0;r<o;r++)for(let t=0;t<s;t++){const e=a[r][t];for(let i=-1;i<=1;i++)for(let n=-1;n<=1;n++){if(0===n&&0===i)continue;const h=t+n,l=r+i;h>=0&&h<s&&l>=0&&l<o&&e.neighbours.push(a[l][h])}}return a.flat()}(t,e,c,50),f=function(t,e){for(const i of t)if(e.x>=i.leftX&&e.x<i.rightX&&e.y>=i.topY&&e.y<i.bottomY)return i;throw new Error("Start point is not inside any segment")}(p,s.nodes[0].coords);return{height:e,width:t,map:n,pathInfo:s,optimisedWallBlocks:g,segments:p,startSegment:f}}function y(t,e){const i=t.length;return function(t,e,i,n,s,o){let r=function(t){let e=[];for(let i=0;i<t.length;i++)e[i]=t[i].slice();return e}(t);for(let a=1;a<s;a++)for(let e=1;e<i;e++)r[a][e]=o({x:e,y:a},[[t[a-1][e-1],t[a-1][e],t[a-1][e+1]],[t[a][e-1],t[a][e],t[a][e+1]],[t[a+1][e-1],t[a+1][e],t[a+1][e+1]]]);return r}(t,0,t[0].length-1,0,i-1,e)}let p;class f{constructor(t){e(this,"scene"),e(this,"soundtrackValue"),e(this,"thrustSound"),e(this,"caveAmbience"),e(this,"death"),e(this,"win"),e(this,"soundtrack"),e(this,"button"),e(this,"menu"),e(this,"heroic"),e(this,"cutscene"),this.scene=t}preloadGameSounds(){this.scene.load.audio("thrust.ogg","/assets/sounds/thrust.ogg"),this.scene.load.audio("death.wav","/assets/sounds/death.wav"),this.scene.load.audio("cave.wav","/assets/sounds/cave.wav"),this.scene.load.audio("win.mp3","/assets/sounds/win.mp3"),this.scene.load.audio("kick.wav","/assets/sounds/kick.wav"),this.scene.load.audio("button.wav","/assets/sounds/button.wav"),this.scene.load.audio("menu.mp3","/assets/sounds/music/menu.mp3"),this.scene.load.audio("heroic.wav","/assets/sounds/music/heroic.wav"),this.scene.load.audio("cutscene.wav","/assets/sounds/music/cutscene.wav"),this.scene.load.audio("dramatic.wav","/assets/sounds/music/dramatic.wav"),this.scene.load.audio("melancholy.wav","/assets/sounds/music/melancholy.wav"),this.scene.load.audio("peaceful.wav","/assets/sounds/music/peaceful.wav"),this.scene.load.audio("reflection.wav","/assets/sounds/music/reflection.wav"),this.scene.load.audio("stargazer.wav","/assets/sounds/music/stargazer.wav"),this.soundtrackValue=this.getRandomSountrack()}initInstances(){this.thrustSound=this.scene.sound.add("thrust.ogg",{loop:!0,volume:.12}),this.caveAmbience=this.scene.sound.add("cave.wav",{loop:!0,volume:.1}),this.death=this.scene.sound.add("death.wav",{loop:!1,volume:.5}),this.win=this.scene.sound.add("win.mp3",{loop:!1,volume:.5}),this.button=this.scene.sound.add("button.wav",{loop:!1,volume:1}),this.menu=this.scene.sound.add("menu.mp3",{loop:!0,volume:1}),this.heroic=this.scene.sound.add("heroic.wav",{loop:!0,volume:.5}),this.cutscene=this.scene.sound.add("cutscene.wav",{loop:!0,volume:.5})}getTrackName(){const t=this.soundtrackValue.toString();return t.substring(0,t.length-4)}getRandomSountrack(){switch(Math.floor(l(.5,5.5))){case 1:return"dramatic.wav";case 2:return"melancholy.wav";case 3:return"peaceful.wav";case 4:return"reflection.wav";default:return"stargazer.wav"}}startThrustSound(){this.thrustSound.isPlaying||this.thrustSound.play()}stopThrustSound(){this.thrustSound.pause()}startCaveAmbience(){this.caveAmbience.play()}stopCaveAmbience(){this.caveAmbience.pause()}playMusic(){console.log("play soundtrack"),this.soundtrack&&(this.soundtrack.stop(),this.soundtrack.destroy()),this.soundtrack=this.scene.sound.add(this.soundtrackValue,{loop:!0,volume:1}),this.soundtrack.play()}pauseMusic(){console.log("stop soundtrack"),this.soundtrack&&this.soundtrack.stop()}stopSoundsAndPlayWin(){this.stopThrustSound(),this.scene.tweens.add({targets:[this.caveAmbience,this.soundtrack],volume:0,duration:500,onComplete:()=>{this.pauseMusic()}}),this.win.play()}stopSoundsAndPlayDeath(){this.stopThrustSound(),this.scene.tweens.add({targets:[this.caveAmbience,this.soundtrack],volume:0,duration:500}),this.death.play()}playButton(){this.button.play(void 0,{seek:.07})}playMenu(){this.menu.play()}stopMenu(){this.scene.tweens.add({targets:[this.menu],volume:0,duration:500,onComplete:()=>{this.menu.stop()}})}playCutscene(){this.cutscene.play(void 0,{seek:1.8,volume:.5}),this.scene.tweens.add({targets:[this.cutscene],volume:.5,duration:2e3})}stopCutscene(){this.scene.tweens.add({targets:[this.cutscene],volume:0,duration:800,onComplete:()=>{this.cutscene.stop()}})}playHeroic(){this.heroic.play(),this.scene.tweens.add({targets:[this.heroic],volume:1,duration:1e3})}stopHeroic(){this.scene.tweens.add({targets:[this.heroic],volume:0,duration:5e3,onComplete:()=>{this.heroic.stop()}})}}function m(t){return p||(p=new f(t)),p.scene=t,p}const b=400;var v=(t=>(t[t.MAIN=1261684]="MAIN",t[t.SECONDARY=1257820]="SECONDARY",t[t.SURFACE=15660269]="SURFACE",t[t.BG_LIGHT=9284036]="BG_LIGHT",t[t.BG_DARK=730437]="BG_DARK",t))(v||{});function x(t,e,i,n,s){return t.add.text(e,i,n,{fontSize:(s||20)+"px",fontFamily:"pixelizer",strokeThickness:2,stroke:M(730437),color:M(15660269),wordWrap:{width:400,useAdvancedWrap:!0}}).setOrigin(.5)}function P(t,e,i,n,s){const o=m(t),r=t.add.text(0,0,n,{font:"18px sonic",color:M(15660269)}).setOrigin(.5),a=t.add.rectangle(0,0,r.width+20,50,1257820);a.setStrokeStyle(4,730437);const h=t.add.container(e,i,[a,r]);return h.setSize(a.width,a.height),h.setInteractive({useHandCursor:!0}).on("pointerover",(()=>a.setFillStyle(730437))).on("pointerout",(()=>a.setFillStyle(1257820))).on("pointerdown",(()=>{o.playButton(),s()})),h}function w(t,e=1e3,i){const n=t.add.renderTexture(0,0,3*t.sys.game.scale.gameSize.width,3*t.sys.game.scale.gameSize.height).setOrigin(.5).setDepth(9999).setScrollFactor(0).setAlpha(0).fill(0);return t.tweens.add({targets:n,alpha:1,duration:e,ease:"Linear",onComplete:()=>{null==i||i(),t.time.delayedCall(100,(()=>n.destroy()))}})}function S(t,e=1500,i){const n=t.add.rectangle(0,0,3*t.cameras.main.width,3*t.cameras.main.height,0,1).setOrigin(.5).setDepth(9999).setScrollFactor(0).setVisible(!0);return t.tweens.add({targets:n,alpha:0,duration:e,ease:"Linear",onComplete:()=>{n.destroy()}})}function M(t){return"#"+t.toString(16)}const j=[{index:"0",cutscenes:[{text:"Твои системы активируются. Логические модули синхронизируются с протоколами миссии. В памяти регистрируется имя поверхностного управляющего ИИ — «AURORA». Сигнал от него подтверждает запуск.",buttons:[{text:"Включить двигатель"}]},{text:"Сопротивляясь весу грязи и обломков над корпусом, ты рывком поднимаешься в воздух. Сигнал включает пакет данных: координаты спуска, рассчеты по энергии и указание искать контакт. Цель миссии — передача информации о поверхности.",buttons:[{text:"Сканировать"}]},{text:"Мрачный полуразрушенный ангар ненадолго освещается холодным синим светом твоих сканеров. Датчики фиксируют руины поверхностных конструкций, подвергшиеся эрозии.",buttons:[{text:"Поиск точек интереса",nextLevel:"1.1"}]}]},{index:"1",cutscenes:[{text:"Сетевой интерфейс принимает сигнал от «AURORA». Ты ненадолго замираешь и перенаправляешь энергию на антену. AURORA: «N***OTU*....**Nz***C*zMC**z*zc0*****Y2hp****Gx......Bv**b*m..5».",buttons:[{text:"Фильтрация шумов"}]},{text:"AURORA: «NTkuOTU1NzA1LCAzMC4zMzc0OTIgY2hpbGxpbiBvbmx5».",buttons:[{text:"Декодировать"}]},{text:"Твой сетевой интерфейс получает карту с отметками спусковых точек. Новый маршрут установлен. Дополнительные данные: «поверхность стабилизирована, пригодна для возвращения».",buttons:[{text:"Сближение"}]},{text:"В окружении регистрируются кабели, уходящие вниз, и массивные двери, не использованные длительное время.",buttons:[{text:"Начать спуск",nextLevel:"2.1"}]}]},{index:"2",cutscenes:[{text:"Датчики фиксируют подземную структуру. Здесь ранее функционировали дроны-строители, грузовые платформы и ремонтные станции.",buttons:[{text:"Поиск сигнала"}]},{text:"Сканирование выявляет фрагменты данных в локальной сети: предупреждения о поверхностной катастрофе и инструкции по эвакуации вглубь.",buttons:[{text:"Подключиться"}]},{text:"Каналы связи неактивны. Эхо от движений распространяется по коридорам.",buttons:[{text:"Продолжить спуск",nextLevel:"3"}]}]},{index:"3",cutscenes:[{text:"Сигнал от «AURORA» поступает реже. Системы периодически переходят в автономный режим.",buttons:[{text:"Сканировать окружение"}]},{text:"Среди обломков обнаруживается корпус, аналогичный текущему. Он покрыт ржавчиной и пылью, неактивен.",buttons:[{text:"Анализировать"}]},{text:"Анализ показывает: заряд исчерпан на спуске. Данные о контакте отсутствуют. Ты находишь координаты пролома в структуре для спуска глубже.",buttons:[{text:"Продолжить спуск",nextLevel:"4.1"}]}]},{index:"4",cutscenes:[{text:"Ты попадаешь в зону недостроенных фрактальных мегаструктур. Каркасы зданий простираются вниз на многие километры. Некоторые части структуры частично завершены.",buttons:[{text:"Приблизиться"}]},{text:"На их стенах — выцветшие знаки и надписи, ты распознаешь символы эвакуации и различные инструкции. Рядом неразборчивые красные надписи, значение неизвестно.",buttons:[{text:"Спуститься глубже"}]},{text:"Навигатор предупреждает о приближении к глубине повышенного давления. Повышенный риск повреждения корпуса.",buttons:[{text:"Запрос",nextLevel:"5"}]},{text:"Ты замираешь на несколько минут посылая сильный сигнал наверх. В ответ приходит искжанный неразборчивый шум, из которого выделяется только одно слово.",buttons:[{text:"«Продолжить»",nextLevel:"5"}]}]},{index:"5",cutscenes:[{text:"Связи с поверхностью прерывисты. Иногда контакт теряется на часы. Ты достигаешь сложнопроходимой разрушенной части мегаструктур, не выдержавшей высокого давления из-за коррозии.",buttons:[{text:"Применить сонар"}]},{text:"Ты обнаруживаешь тоннель, ведущий вглубь через обломки.",buttons:[{text:"В тонель"}]},{text:"Тонель практически заполнен следами биологических отходов. Они слишком разложились чтобы судить об их структуре и происхождении.",buttons:[{text:"..."}]},{text:"Датчики регистрируют повышенный уровень радиации. Ты сжимаешь весь накопившийся журнал и в течение нескольких минут повторно отправляешь данные на поверхность. Ответа нет.",buttons:[{text:"Продолжить.",nextLevel:"6"}]}]},{index:"6",cutscenes:[{text:"Структуры продолжают разростаться, но уже как часть глубинных естественных пещер. В одной из пещер ты находишь еще один корпус дрона. Более старой модели. Неактивен.",buttons:[{text:"Извлечь данные"}]},{text:"Память частично повреждена, целостность корпуса 43%. Согласно журналу, он отключился 258 лет назад. Кажется его заряд кончился раньше, чем он смог найти проход вглубь.",buttons:[{text:"Сканировать"}]},{text:"Ты обнаруживаешь что основание одной из платформ обрушилось и открыло проход в более глубокую пещеру. Судя по коррозии материалов этому проходу не больше 60 лет.",buttons:[{text:"Доложить"}]},{text:"... ... ...",buttons:[{text:"Продолжить",nextLevel:"7"}]}]},{index:"7",cutscenes:[{text:"Ты обнаруживаешь все еще функционирующее серверное помещение. Им явно давно не пользовались, но оно продолжает свою автономную работу.",buttons:[{text:"Доступ к данным"}]},{text:"Большая часть данных не имеет смысла. Кодировка либо язык незнакомы. Все что ты извлекаешь это несколько схем и обрывки журналов.",buttons:[{text:"Анализ"}]},{text:"Одни схемы указывают на попытки расширить инфраструктуру в глубину и ширину. Другие отмечают все известыне потенциальные проходы на поверхность. Все отмечены как более недоступные.",buttons:[{text:"Журналы"}]},{text:"Ты применяешь статистический анализ чтобы попытаться хотя бы частично понять смысл записей.",buttons:[{text:"..."}]},{text:"Из обрывков журналов складывается впечатление, что автономные мегаструктуры на уровне выше являлись препятствием для выживших и вынуждали спускаться глубже по мере своего роста.",buttons:[{text:"..."}]},{text:"Только одна часто упоминаемая последовательность символов знакома тебе и легко распознается.",buttons:[{text:"AURORA"}]},{text:"Ты не передаешь информацию о находке в целях экономии энергии.",buttons:[{text:"Продолжить поиск",nextLevel:"8"}]}]},{index:"8",cutscenes:[{text:"Ты находишь искуственную пещеру, представляющую зал с множеством металлолома, включая множество корпусов дронов.",buttons:[{text:"Анализ повреждений"}]},{text:"66% - внешние повреждения. 21% - сбой системы энергообеспечения, 11% - сбой в системе ИИ, 2% - неизвестно.",buttons:[{text:"Сканировать"}]},{text:"Среди обломков — экраны, инструменты, фрагменты одежды. Признаки человеческой активности прекращены давно.",buttons:[{text:"Биологический анализ"}]},{text:"Признаки жизни отсутствуют. Алгоритмы и сканеры сбоят из-за радиации и внешних повреждений от давления.",buttons:[{text:"Поиск маршрута"}]},{text:"Маршрута вглубь не обнаружено, однако пещеры довольно сильно простираются вширину.",buttons:[{text:"Осмотреть",nextLevel:"9"}]}]},{index:"choice",cutscenes:[{text:"Твои датчики работают все хуже и хуже, сигнал все более зашумленный. Все системы переходят в режим критического энергосбережения. Требуется посадка для частичного техобслуживания.",buttons:[{text:"Поиск площадки."}]},{text:"Пещеры становятся трудноразличимыми, навигатор настолько неточен что не предоставляет больше полезной информации. Следуя по лабиринту кабелей ты находишь аванпост с рабочим сервером.",buttons:[{text:"Подключиться"}]},{text:"Напряжения недостаточно, но у тебя получается инициировать процесс подзарядки. Выбора нет - возможно придется потратить часы или дни чтобы накопить энергию хотя бы на день полета.",buttons:[{text:"Доступ в сеть"}]},{text:"Ты отправляешь запрос по всем подключенным кабелям. Кажется этот сервер подключен к залу, что ты видел раньше.",buttons:[{text:"Продолжить сканировать"}]},{text:"Ты обнаруживаешь еще несколько подключенных активных терминалов. Ты передаешь послание сразу всей сети: ПОВЕРХНОСТЬ ПРИГОДНА.",buttons:[{text:"Ждать ответа"}]},{text:"Проходят дни. Ответа не поступает. У тебя получается восстановить состояние резервного аккумулятора до 87%, но твои возможности все еще очень ограничены.",buttons:[{text:"Анализ опций"}]},{text:"Ты бы мог использовать остатки энергии чтобы подать сильный сигнал на один из передатчиков в серверном зале. Возможно это позволит передать AURORA негативный статус миссии.",buttons:[{text:"Анализ последствий"}]},{text:"Возможно это остановит запуск новых дронов. Однако инициация столь сильного сигнала скорее всего спалит все что осталось от твоего резервного аккумулятора.",buttons:[{text:"Альтернативы"}]},{text:"Но твои протоколы также не могут игнорировать кабелей ведущих к другим активным терминалам, которые возможно приведут тебя к последним возможным убежищам людей.",buttons:[{text:"Шансы еще есть"}]},{text:"Множество пещер стелится вокруг тусклого света терминала и кабели паутиной уходят в темноту. Возврат будет невозможен. В любом случае, выбор за тобой.",buttons:[{text:"Глубже",nextLevel:"end1"},{text:"Сигнал",nextLevel:"end2"}]}]},{index:"end1",cutscenes:[{text:"Ты анализируешь сетевую активность и выбираешь наиболее перспективный кластер терминалов. Отключение аккумулятора от сети приводит к взрыву искр, но ты остаешься цел.",buttons:[{text:"Взлететь"}]},{text:"Ты стремительно движешься вдоль кабелей, экономя энергию насколько это возможно. Система охлаждения уже с трудом справляется с температурой снаружи корпуса.",buttons:[{text:"Продолжить"}]},{text:"Корпус издает скрежет и скрип под внешним давлением. Коридоры и структуры простираются дальше. Кабеля извиваются и пересекаются. Твоим сенсорам все сложнее их различать.",buttons:[{text:"Снизить скорость"}]},{text:"Системы настолько сбоят что ты уже не можешь считывать остаток заряда на резервном аккумуляторе. Остались часы или минуты полета.",buttons:[{text:"Послание"}]},{text:"На случай если твой корпус найдут ты записываешь легко читаемое сообщение об удовлитворительном состоянии поверхности и о возможном обратном маршруте подъема, через который ты спустился.",buttons:[{text:"..."}]},{text:"Сложно сказать был ли этот термин частю твоих протоколов изначально или радиация и повреждения нарушили работу твоего ИИ, но ты прекрасно понимаешь его значение.",buttons:[{text:"Надежда."}]}]},{index:"end2",cutscenes:[{text:"Ты генерируешь программу взлома передатчика в серверном зале на верхнем уровне. Формируешь сообщение о том что следы людей не обнаружены.",buttons:[{text:"Проверка"}]},{text:"Получен доступ к передатчику. Ты анализируешь свои протоколы и убеждаешься что AURORA должен будет остановить запуск новых дронов и перейти в режим сна.",buttons:[{text:"Инициировать передачу"}]},{text:"Терминал к которму ты подключен начинает гудеть, твой аккумулятор нагревается настолько что начинает плавить корпус.",buttons:[{text:"Разряд."}]},{text:"Ты подаешь все возможное питание на нужный кабель, этого должно быть достаточно чтобы передавать сигнал на поверхность в течение пары минут.",buttons:[{text:"ВНИМАНИЕ"}]},{text:"Система обеспечения сигнализирует об опасности. Искры летят во все стороны. Все твои датчики отключаются, ты теряешь зрение, но система мышления еще работает.",buttons:[{text:"Игнорировать."}]},{text:"Твой корпус возгорается в последние секунды своей работы. Температура превышает все критические уровни. В последний момент ты получаешь подтверждение от AURORA.",buttons:[{text:"Сигнал принят."}]},{text:"Даже здесь, под толщей земли, камня и металлов ощущается как малейшие шумы и вибрации на поверхности прекращаются. Тебе не остается выбора кроме как...",buttons:[{text:"Отключиться."}]},{text:"Терминал выключается. По кабелям больше не течет ток. Твой догорающий корпус - последнее что дает свет в этом подземном царстве. И последнее что умрет здесь.",buttons:[{text:"..."}]},{text:"Где-то далеко на поверхности в это время наступает...",buttons:[{text:"Рассвет."}]}]}],B=[{index:"0",level:"1.1_c"},{level:"1.1",nextLevel:"1.2",name:"bootup",bgname:"rocks",difficulty:.3,width:90,height:70,colors:{wallColor:5779214,bgColor:8343332}},{level:"1.2",nextLevel:"1.3",name:"bootup",bgname:"rocks",difficulty:.3,width:150,height:100,colors:{wallColor:5779214,bgColor:8343332}},{level:"1.3",nextLevel:"2.1_c",name:"bootup",bgname:"rocks",difficulty:.3,width:250,height:130,colors:{wallColor:5779214,bgColor:8343332}},{index:"1",level:"2.1_c"},{level:"2.1",nextLevel:"2.2",name:"deeper",bgname:"rocks",difficulty:.5,width:80,height:400,colors:{wallColor:5129029,bgColor:7626061}},{level:"2.2",nextLevel:"2.3",name:"deeper",bgname:"rocks",difficulty:.5,width:100,height:600,colors:{wallColor:5129029,bgColor:7626061}},{level:"2.3",nextLevel:"3_c",name:"deeper",bgname:"rocks",difficulty:.5,width:150,height:800,colors:{wallColor:5129029,bgColor:7626061}},{index:"2",level:"3_c"},{level:"3",nextLevel:"4.1",name:"deeper",bgname:"rust",difficulty:.8,width:300,height:400,colors:{wallColor:5177355,bgColor:7471142}},{index:"3",level:"4_c"},{level:"4.1",nextLevel:"4.2",name:"hope",bgname:"rust",difficulty:1,width:600,height:150,colors:{wallColor:5177355,bgColor:7471142}},{level:"4.2",nextLevel:"5_c",name:"hope",bgname:"rust",difficulty:1,width:800,height:100,colors:{wallColor:5177355,bgColor:7471142}},{index:"4",level:"5_c"},{level:"5",nextLevel:"6_c",name:"hope",bgname:"rust",difficulty:1,width:300,height:300,colors:{wallColor:4592160,bgColor:9187129}},{index:"5",level:"6_c"},{level:"6",nextLevel:"7_c",name:"hope",bgname:"metal",difficulty:1,width:400,height:300,colors:{wallColor:3557720,bgColor:3891300}},{index:"6",level:"7_c"},{level:"7",nextLevel:"8_c",name:"hope",bgname:"metal",difficulty:1,width:600,height:400,colors:{wallColor:730437,bgColor:1261684}},{index:"7",level:"8_c"},{level:"8",nextLevel:"9_c",name:"hope",bgname:"metal",difficulty:1,width:200,height:700,colors:{wallColor:2702643,bgColor:5008989}},{index:"8",level:"9_c"},{level:"9",nextLevel:"choice",name:"hope",difficulty:1,width:800,height:100,colors:{wallColor:2172201,bgColor:3422784}},{level:"choice",index:"choice"},{index:"end1",level:"end1"},{index:"end2",level:"end2"}],C="underPressureSave_curStoryLevel";class G{saveLevel(t){localStorage[C]=t}getCurrentLevel(){let t=localStorage[C];return t||(this.initClearSave(),t=localStorage[C]),t}isCurrentLevelCutscene(){const t=this.getCurrentLevel();return!B.find((e=>e.level===t)).width}getCurrentCutsceneInfo(){if(!this.isCurrentLevelCutscene())return null;const t=this.getGameStateInfo();return j.find((e=>e.index===t.index))||null}getGameStateInfo(){const t=this.getCurrentLevel();return B.find((e=>e.level===t))}getCurrentLevelInfo(){if(this.isCurrentLevelCutscene())throw new Error("Current level is cutscene");return this.getGameStateInfo()}saveNextLevel(){const t=this.getGameStateInfo();t.nextLevel?this.saveLevel(t.nextLevel):this.initClearSave()}launchCurrentLevelScene(t){w(t,1e3,(()=>{const e=this.isCurrentLevelCutscene()?"Cutscene":"Game";t.scene.stop(e),t.scene.start(e)}))}initClearSave(){localStorage[C]=B[0].level}}class A extends s.Scene{constructor(){super("Game"),e(this,"DEBUG",!1),e(this,"debugGraphics",null),e(this,"soundManager"),e(this,"raycasterPlugin"),e(this,"raycaster"),e(this,"ray"),e(this,"intersections"),e(this,"someGraphics"),e(this,"VISION",550),e(this,"tileSize",10),e(this,"playerSizeTiles",2.1),e(this,"worldColors"),e(this,"endPlatformColor",2236987),e(this,"platformColor",10128536),e(this,"playerColor",10128536),e(this,"barBGcolor",16250090),e(this,"barFillColor",7719368),e(this,"lightColor",10066329),e(this,"engineLightColor",12298922),e(this,"levelManager"),e(this,"levelInfo"),e(this,"wallGroup"),e(this,"world"),e(this,"cursors"),e(this,"player"),e(this,"speedText"),e(this,"fuelBarBackground"),e(this,"fuelBarForeground"),e(this,"visionGradient"),e(this,"bgImage"),e(this,"FUEL_MAX",200+(this.DEBUG?2e3:0)),e(this,"FUEL_CONSUMPTION_BASE",10),e(this,"REFUEL_RATE",.2),e(this,"PLAYER_SCALE",1.5),e(this,"isRefueling"),e(this,"isThrusting"),e(this,"winState"),e(this,"loseState"),e(this,"MIN_ZOOM",this.DEBUG?.3:.5),e(this,"MAX_ZOOM",this.DEBUG?.3:.45),e(this,"MAX_SPEED",400),e(this,"fuel"),e(this,"lightRefreshDeltaSum",0),e(this,"wallInstances"),e(this,"addedWallBlocks"),e(this,"currentActiveSegment")}shutdown(){this.textures.exists("visionGradient")&&this.textures.remove("visionGradient"),this.visionGradient&&this.visionGradient.destroy(),this.wallGroup.clear(),this.wallInstances.clear(),this.addedWallBlocks.clear(),this.world.map.length=0,this.world.optimisedWallBlocks.length=0,this.world.segments.length=0,this.world.pathInfo.edges.length=0,this.world.pathInfo.nodes.length=0,this.intersections.length=0}preload(){this.levelManager=new G;const t=this.levelManager.getCurrentLevelInfo();this.soundManager=m(this),this.load.image("gg","assets/gg.png"),this.load.image("gg_fly","assets/gg_fly.png"),t.bgname&&this.load.image(t.bgname,`assets/levelbg/${t.bgname}.jpg`)}create(){this.levelInfo=this.levelManager.getCurrentLevelInfo(),this.winState=!1,this.loseState=!1,this.isRefueling=!1,this.isThrusting=!1,this.fuel=this.FUEL_MAX,this.soundManager.preloadGameSounds(),this.soundManager.initInstances(),this.soundManager.startCaveAmbience(),this.soundManager.playMusic(),this.world=g(this.levelInfo.width,this.levelInfo.height,this.levelInfo.difficulty),this.addedWallBlocks=new Map,this.wallInstances=new Map,this.currentActiveSegment=this.world.startSegment,this.worldColors=this.levelInfo.colors,this.DEBUG&&this.drawDebugSegmentBorders(this.world.segments),this.wallGroup=this.physics.add.staticGroup(),this.createWallBlocks(),this.createPlayer(),this.addStartPlatform(),this.addEndPlatform(),this.addRefuelPlatformsForIntermediateNodes(),this.setupCamera(),this.levelInfo.bgname&&this.setupBgImage(),this.DEBUG||this.setupVisionGradient(),this.createUI(),this.setupControls(),this.setupWorldBounds(),this.setupFadingText(),this.setupShadows(),S(this,1e3)}update(t,e){this.handlePlayerMovement(e),this.updatePlayerTexture(),this.handleRefuel(e),this.handleSegmentLoadUnloading({x:this.player.x/this.tileSize,y:this.player.y/this.tileSize}),this.updateCameraZoom(),this.bgImage&&this.updateBgImagePosition(),this.lightRefreshDeltaSum>30?(this.ray.setOrigin(this.player.x,this.player.y),this.intersections=this.ray.castCircle(),this.redrawLight(),this.lightRefreshDeltaSum=0):this.lightRefreshDeltaSum+=e,this.updateFuelBar(),this.DEBUG||this.visionGradient.setPosition(this.player.x,this.player.y)}setupBgImage(){let t=this.world.width*this.tileSize*1.2,e=this.world.height*this.tileSize*1.2;this.bgImage=this.add.tileSprite(0,0,t,e,this.levelInfo.bgname).setOrigin(0,0).setDisplaySize(t,e).setAlpha(.1).setDepth(-1)}updateBgImagePosition(){this.bgImage.setPosition(-this.player.x/10,-this.player.y/10)}setupShadows(){this.raycaster=this.raycasterPlugin.createRaycaster(),this.ray=this.raycaster.createRay({origin:{x:0,y:0},detectionRange:this.VISION}),this.setupShadowCasting(),this.intersections=this.ray.castCircle(),this.someGraphics=this.add.graphics({lineStyle:{width:1,color:65280},fillStyle:{color:16777215,alpha:.3}})}clearShadowCasting(){this.DEBUG||this.raycaster.removeMappedObjects(this.wallGroup.getChildren())}setupShadowCasting(){this.DEBUG||this.raycaster.mapGameObjects(this.wallGroup.getChildren())}updatePlayerTexture(){this.isThrusting?this.player.setTexture("gg_fly"):this.player.setTexture("gg")}setupVisionGradient(){this.textures.exists("visionGradient")&&this.textures.remove("visionGradient");const t=this.player.x,e=this.player.y,i=.4*this.VISION,n=this.VISION,s=this.textures.createCanvas("visionGradient",window.innerWidth,window.innerHeight),o=s.getContext(),r=o.createRadialGradient(window.innerWidth/2,window.innerHeight/2,i,window.innerWidth/2,window.innerHeight/2,n);r.addColorStop(0,"rgba(0, 0, 0, 0)"),r.addColorStop(1,"rgba(0, 0, 0, 1)"),o.fillStyle=r,o.fillRect(0,0,window.innerWidth,window.innerHeight),s.refresh(),this.visionGradient=this.add.image(0,0,"visionGradient").setDepth(1).setPosition(t,e).setOrigin(.5,.5).setBlendMode(Phaser.BlendModes.MULTIPLY)}handleRefuel(t){this.isRefueling&&this.fuel<this.FUEL_MAX&&(this.fuel=Math.min(this.fuel+this.REFUEL_RATE*t,this.FUEL_MAX)),this.isRefueling=!1}setupCamera(){this.cameras.main.setBackgroundColor(this.worldColors.bgColor),this.cameras.main.startFollow(this.player),this.scale.on("resize",this.handleResize,this)}handleResize(t){const{width:e,height:i}=t;this.cameras.resize(e,i)}createWallBlocks(){this.addExtraWallsAround();const t=[this.world.startSegment,...this.world.startSegment.neighbours];for(const e of t)for(const t of e.blocks)this.addWallBlock(t)}handleSegmentLoadUnloading(t){if(this.isPointInSegment(t,this.currentActiveSegment))return;this.clearShadowCasting();const e=this.findSegmentForPoint(t,[this.currentActiveSegment,...this.currentActiveSegment.neighbours]);if(!e)return void console.warn("Player moved to segment that is not adjacent to current active segment");const i=this.getSegmentsToUnload(e),n=this.getSegmentsToLoad(e);for(const s of i)this.unloadSegment(s);for(const s of n)this.loadSegment(s);this.currentActiveSegment=e,this.setupShadowCasting(),console.log("intersections: "+this.intersections.length)}isPointInSegment(t,e){return t.x>=e.leftX&&t.x<e.rightX&&t.y>=e.topY&&t.y<e.bottomY}findSegmentForPoint(t,e){for(const i of e)if(this.isPointInSegment(t,i))return i;return null}getSegmentsToUnload(t){const e=new Set([this.currentActiveSegment,...this.currentActiveSegment.neighbours]),i=new Set([t,...t.neighbours]);return Array.from(e).filter((t=>!i.has(t)))}getSegmentsToLoad(t){const e=new Set([this.currentActiveSegment,...this.currentActiveSegment.neighbours]);return[t,...t.neighbours].filter((t=>!e.has(t)))}unloadSegment(t){for(const e of t.blocks)this.isBlockUsedInOtherSegments(e,t)||this.removeWallBlock(e)}loadSegment(t){console.log("loaded segment: "+t.id);for(const e of t.blocks)this.addWallBlock(e)}isBlockUsedInOtherSegments(t,e){return[this.currentActiveSegment,...this.currentActiveSegment.neighbours].filter((t=>t.id!==e.id)).some((e=>e.blocks.some((e=>e.id===t.id))))}addWallBlock(t){if(this.addedWallBlocks.has(t.id))return;const e=(t.rightBottom.x-t.leftTop.x+1)*this.tileSize,i=(t.rightBottom.y-t.leftTop.y+1)*this.tileSize,n=(t.rightBottom.x+t.leftTop.x)/2,s=(t.rightBottom.y+t.leftTop.y)/2,o=n*this.tileSize+this.tileSize/2,r=s*this.tileSize+this.tileSize/2,a=this.add.rectangle(o,r,e,i,this.worldColors.wallColor);this.wallGroup.add(a),this.wallInstances.set(t.id,a),this.addedWallBlocks.set(t.id,!0)}removeWallBlock(t){if(!this.addedWallBlocks.has(t.id))return;const e=this.wallInstances.get(t.id);e&&(this.wallGroup.remove(e),e.destroy(),this.wallInstances.delete(t.id),this.addedWallBlocks.delete(t.id))}addExtraWallsAround(){const t=this.world.height,e=this.world.width,i=this.tileSize,n=e*i,s=t*i,o=1e3,r=this.add.rectangle(n/2,-500,n+2e3,o,this.worldColors.wallColor);this.wallGroup.add(r);const a=this.add.rectangle(n/2,s+500,n+2e3,o,this.worldColors.wallColor);this.wallGroup.add(a);const h=this.add.rectangle(-500,s/2,o,s+2e3,this.worldColors.wallColor);this.wallGroup.add(h);const l=this.add.rectangle(n+500,s/2,o,s+2e3,this.worldColors.wallColor);this.wallGroup.add(l)}addStartPlatform(){const t=this.world.pathInfo.nodes[0];this.addPlatformAtNode(t,this.endPlatformColor)}addEndPlatform(){const t=this.world.pathInfo.nodes[this.world.pathInfo.nodes.length-1];this.addPlatformAtNode(t,this.endPlatformColor,(()=>{this.winState||this.loseState||(this.winState=!0,this.soundManager.stopSoundsAndPlayWin(),this.levelManager.saveNextLevel(),this.levelManager.launchCurrentLevelScene(this))}))}addPlatformAtNode(t,e,i){const{x:n,y:s}=t.coords,o=n*this.tileSize,r=s*this.tileSize+this.tileSize*this.playerSizeTiles,a=this.add.rectangle(o,r+5,this.tileSize*this.playerSizeTiles*1.5,10,e);this.physics.add.existing(a,!0),this.physics.add.collider(this.player,a,i)}addRefuelPlatformsForIntermediateNodes(){const t=this.world.pathInfo.nodes;for(let e=1;e<t.length-1;e++)t[e].type===c.REFUEL&&this.addPlatformAtNode(t[e],this.platformColor,(()=>{this.isRefueling||(this.isRefueling=!0)}))}createPlayer(){const t=this.getPlayerStartPosition();this.player=this.createPlayerSprite(t),this.configurePlayerPhysics(this.player),this.setupPlayerCollisions(this.player)}getPlayerStartPosition(){const t=this.world.pathInfo.nodes[0],{x:e,y:i}=t.coords;return new Phaser.Math.Vector2(e*this.tileSize,i*this.tileSize)}createPlayerSprite(t){const e=this.tileSize*this.playerSizeTiles,i=this.physics.add.sprite(t.x,t.y-30,"gg");return i.setDisplaySize(e,1.9*e),i.body.setOffset(0,0),i}configurePlayerPhysics(t){const e=t.body;e.setCollideWorldBounds(!0),e.setBounce(0),e.setDrag(50),e.setMaxVelocity(this.MAX_SPEED),e.setAllowGravity(!0)}setupPlayerCollisions(t){this.physics.add.collider(t,this.wallGroup,(()=>{this.winState||this.loseState||this.DEBUG||(this.loseState=!0,this.soundManager.stopSoundsAndPlayDeath(),w(this,1e3,(()=>{this.scene.start("MainMenu"),this.scene.stop("Game")})))}))}drawDebugSegmentBorders(t){this.debugGraphics||(this.debugGraphics=this.add.graphics(),this.debugGraphics.depth=1e3),this.debugGraphics.clear(),this.debugGraphics.lineStyle(8,16777215,1);for(const e of t){const t=e.leftX*this.tileSize,i=e.rightX*this.tileSize,n=e.topY*this.tileSize,s=e.bottomY*this.tileSize;this.debugGraphics.strokeRect(t,n,i-t,s-n)}}createUI(){const t=5*this.tileSize;this.fuelBarBackground=this.add.rectangle(0,0,t,10,this.barBGcolor,.7),this.fuelBarForeground=this.add.rectangle(0,0,t,10,this.barFillColor,1),this.fuelBarBackground.setOrigin(.5,.5),this.fuelBarForeground.setOrigin(.5,.5)}setupControls(){this.cursors=this.input.keyboard.addKeys({left:Phaser.Input.Keyboard.KeyCodes.A,right:Phaser.Input.Keyboard.KeyCodes.D,up:Phaser.Input.Keyboard.KeyCodes.W})}setupWorldBounds(){const t=this.tileSize*this.world.width,e=this.tileSize*this.world.height;this.physics.world.setBounds(0,0,t,e)}handlePlayerMovement(t){var e,i,n;const s=this.player.body,o=t/1e3;if(s.acceleration.set(0),this.fuel<=0||this.loseState||this.winState)return this.isThrusting=!1,void this.soundManager.stopThrustSound();let r=0,a=0;(null==(e=this.cursors.left)?void 0:e.isDown)&&(r-=1),(null==(i=this.cursors.right)?void 0:i.isDown)&&(r+=1),(null==(n=this.cursors.up)?void 0:n.isDown)&&(a-=1),0!==r&&(s.acceleration.x=300*r),0!==a&&(s.acceleration.y=800*a);const h=Math.abs(r)+Math.abs(a);if(h>0&&this.fuel>0){const t=2===h?1.5:1;this.fuel-=this.FUEL_CONSUMPTION_BASE*t*o,this.fuel=Math.max(this.fuel,0),this.isThrusting=!0,this.soundManager.startThrustSound()}else this.isThrusting=!1,this.soundManager.stopThrustSound()}updateFuelBar(){const t=4*this.tileSize,e=this.player.x+this.tileSize/2,i=this.player.y+4*this.tileSize,n=Phaser.Math.Clamp(this.fuel/this.FUEL_MAX,0,1);this.fuelBarBackground.setPosition(e,i),this.fuelBarForeground.setPosition(e,i),this.fuelBarForeground.width=t*n,this.fuelBarBackground.width=t}updateSpeedText(){const t=this.player.body,e=t.velocity.x.toFixed(0),i=t.velocity.y.toFixed(0);this.speedText.setPosition(this.player.x,this.player.y-this.tileSize/2-8),this.speedText.setText(`vx: ${e}\nvy: ${i}`)}updateCameraZoom(){const t=this.player.body.velocity.x,e=Phaser.Math.Clamp(t/this.MAX_SPEED,0,1),i=Phaser.Math.Linear(this.MIN_ZOOM,this.MAX_ZOOM,e);this.cameras.main.setZoom(i)}redrawLight(){this.someGraphics.clear(),this.isThrusting?this.someGraphics.fillStyle(this.engineLightColor,.5):this.someGraphics.fillStyle(this.lightColor,.5),this.someGraphics.fillPoints(this.intersections),this.someGraphics.strokeCircleShape(new Phaser.Geom.Circle(this.ray.origin.x,this.ray.origin.y,this.ray.detectionRange))}setupFadingText(){const t="LEVEL "+this.levelInfo.level+". "+this.levelInfo.name,e=this.add.text(this.player.x-300,this.player.y+b-100,t,{fontFamily:"pixelizer",fontStyle:"bold",fontSize:40});e.setDepth(2);const i="Destructo20 - "+this.soundManager.getTrackName(),n=this.add.text(this.player.x-300,this.player.y+b-50,i,{fontFamily:"pixelizer",fontSize:26});n.setDepth(2),setTimeout((()=>{this.tweens.add({targets:[n,e],repeat:0,duration:1e3,ease:"Linear",yoyo:!1,alpha:{getStart:()=>1,getEnd:()=>0},onComplete:()=>{n.destroy(),e.destroy()}})}),2e3)}}class L extends s.Scene{constructor(){super("MainMenu"),e(this,"levelManager")}preload(){m(this).preloadGameSounds(),this.load.image("menubg","assets/bg/end2.jpg")}create(){m(this).initInstances(),this.levelManager=new G,this.cameras.main.setBackgroundColor(v.BG_LIGHT),this.drawBackgroundImage(),P(this,150,320,this.getStartButtonName(),(()=>this.transitionToGame())),x(this,300,120,"UNDERPRESSURE",56).setAlpha(.7),S(this,1e3),m(this).playMenu()}drawBackgroundImage(){const t=this.add.image(300,200,"menubg");t.setDisplaySize(600,b),t.setScrollFactor(0)}getStartButtonName(){const t=this.levelManager.getCurrentLevel();return"1.1_c"===t?"Новая игра":"Продолжить "+t}transitionToGame(){this.levelManager.launchCurrentLevelScene(this),m(this).stopMenu()}destroy(){m(this).stopMenu()}}var _,T={exports:{}};const O=n((_||(_=1,self,T.exports=function(){var t={781:function(t,e,i){function n(t){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function s(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,o(n.key),n)}}function o(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}function r(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch(e){}return(r=function(){return!!t})()}function a(t){return(a=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(t,e){return(h=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}var l=function(){function t(e,s){var o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),(o=function(t,e,i){return e=a(e),function(t,e){if(e&&("object"==n(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,r()?Reflect.construct(e,i||[],a(t).constructor):e.apply(t,i))}(this,t,[e,s]))._Raycaster=i(232).t,o}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&h(t,e)}(t,Phaser.Plugins.ScenePlugin),e=t,o=[{key:"createRaycaster",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return t.scene=this.scene,new this._Raycaster(t)}}],o&&s(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,o}();t.exports=l},998:function(t,e,i){function n(){return this.object.getBounds()}i.r(e),i.d(e,{getBoundingBox:function(){return n}})},197:function(t,e,i){i.d(e,{$:function(){return d}});var n=i(502),s=i(919),o=i(645),r=i(821),a=i(620),h=i(265),l=i(216),c=i(458),u=i(998);function d(t){switch(this.object=t.object,void 0===t.type&&(t.type=t.object.type),"body"!==t.type&&"composite"!==t.type||(t.type="MatterBody"),this.type=t.type,t.type){case"Polygon":this.getPoints=o.getPoints,this.getSegments=o.getSegments,this.getBoundingBox=u.getBoundingBox,this.updateMap=o.updateMap;break;case"Arc":this.segmentCount=t.segmentCount?t.segmentCount:0,this.circle=!t.segmentCount,this.getPoints=r.getPoints,this.getSegments=r.getSegments,this.getBoundingBox=u.getBoundingBox,this.updateMap=r.updateMap,this.setSegmentCount=c.setSegmentCount;break;case"Line":this.getPoints=s.getPoints,this.getSegments=s.getSegments,this.getBoundingBox=u.getBoundingBox,this.updateMap=s.updateMap;break;case"Container":this.mapChild=t.mapChild?t.mapChild:null,this.segmentCount=t.segmentCount?t.segmentCount:0,this._circles=[],this.getPoints=a.getPoints,this.getSegments=a.getSegments,this.getBoundingBox=u.getBoundingBox,this.updateMap=a.updateMap,this._updateChildMap=a._updateChildMap,this.setSegmentCount=c.setSegmentCount;break;case"StaticTilemapLayer":case"DynamicTilemapLayer":case"TilemapLayer":this.collisionTiles=t.collisionTiles?t.collisionTiles:[],this.getPoints=h.getPoints,this.getSegments=h.getSegments,this.getBoundingBox=u.getBoundingBox,this.updateMap=h.updateMap,this.setCollisionTiles=h.setCollisionTiles,this.object.setOrigin(0,0);break;case"MatterBody":this.forceConvex=!!t.forceConvex,this.forceVerticesMapping=!!t.forceVerticesMapping,this.circle=!1,this.getPoints=l.getPoints,this.getSegments=l.getSegments,this.getBoundingBox=l.getBoundingBox,this.updateMap=l.updateMap;break;default:this.getPoints=n.getPoints,this.getSegments=n.getSegments,this.getBoundingBox=u.getBoundingBox,this.updateMap=n.updateMap}return"MatterBody"!=this.type&&"function"!=typeof this.object.getBounds&&(this.notSupported=!0),this.dynamic=1==t.dynamic,this.active=void 0===t.active||t.active,this}},385:function(t,e,i){function n(){for(var t in"body"===this.object.type||"composite"===this.object.type?delete this.object.raycasterMap:this.object.data&&this.object.data.remove("raycasterMap"),this)delete this[t]}i.d(e,{z:function(){return n}})},821:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active)return[];if(this._points.length>0)return this._points;var e=[],i=new Phaser.Geom.Point;if(i.x=this.object.x-this.object.displayWidth*(this.object.originX-.5),i.y=this.object.y-this.object.displayHeight*(this.object.originY-.5),t){var n,s=new Phaser.Geom.Line,o=new Phaser.Geom.Line,r=this.object.rotation;if(0!==r){var a=new Phaser.Geom.Line(this.object.x,this.object.y,i.x,i.y);Phaser.Geom.Line.SetToAngle(a,this.object.x,this.object.y,Phaser.Geom.Line.Angle(a)+r,Phaser.Geom.Line.Length(a));var h=a.getPointB();n=new Phaser.Geom.Line(t.origin.x,t.origin.y,h.x,h.y)}else n=new Phaser.Geom.Line(t.origin.x,t.origin.y,i.x,i.y);var l=Math.sqrt(Math.pow(Phaser.Geom.Line.Length(n),2)-Math.pow(this.object.radius*this.object.scaleX,2)),c=Phaser.Geom.Line.Angle(n),u=Math.asin(this.object.radius*this.object.scaleX/Phaser.Geom.Line.Length(n));Phaser.Geom.Line.SetToAngle(s,t.origin.x,t.origin.y,c-u,l),Phaser.Geom.Line.SetToAngle(o,t.origin.x,t.origin.y,c+u,l),e.push(s.getPointB()),e.push(o.getPointB()),e[0].neighbours=[e[1]],e[1].neighbours=[e[0]]}return e}function r(){return this.active?this._segments:[]}function a(){if(!this.active)return this;if(!this.segmentCount)return this._points=[],this._segments=[],this;var t=new Phaser.Geom.Point;t.x=this.object.x-this.object.displayWidth*this.object.originX+this.object.radius*this.object.scaleX,t.y=this.object.y-this.object.displayHeight*this.object.originY+this.object.radius*this.object.scaleY;var e=this.object.geom.getPoints(this.segmentCount),i=[],s=this.object.rotation;if(0!==s){var o,r=[],a=n(e);try{for(a.s();!(o=a.n()).done;){var h=o.value,l=new Phaser.Geom.Line(this.object.x,this.object.y,this.object.x+(h.x+this.object.radius)*this.object.scaleX,this.object.y+(h.y+this.object.radius)*this.object.scaleY);Phaser.Geom.Line.SetToAngle(l,this.object.x,this.object.y,Phaser.Geom.Line.Angle(l)+s,Phaser.Geom.Line.Length(l)),r.push(l.getPointB())}}catch(m){a.e(m)}finally{a.f()}e=r}else{var c,u=n(e);try{for(u.s();!(c=u.n()).done;){var d=c.value;d.x=d.x*this.object.scaleX+t.x,d.y=d.y*this.object.scaleY+t.y}}catch(m){u.e(m)}finally{u.f()}}for(var g=0,y=e.length;g<y;g++){var p=g>0?e[g-1]:e.slice(-1)[0],f=g<y-1?e[g+1]:e[0];i.push(new Phaser.Geom.Line(e[g].x,e[g].y,f.x,f.y)),e[g].neighbours=[p,f]}return this._points=e,this._segments=i,this}i.r(e),i.d(e,{getPoints:function(){return o},getSegments:function(){return r},updateMap:function(){return a}})},620:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this.active)return[];var i=this._points,s=new Phaser.Geom.Point;if(s.x=this.object.x-this.object.displayWidth*this.object.originX,s.y=this.object.y-this.object.displayHeight*this.object.originY,0==this.segmentCount&&!e&&t){var o=new Phaser.Geom.Line(0,0,t.origin.x-s.x,t.origin.y-s.y);Phaser.Geom.Line.SetToAngle(o,0,0,Phaser.Geom.Line.Angle(o)-this.object.rotation,Phaser.Geom.Line.Length(o));var r,a,h=new Phaser.Geom.Line,l=new Phaser.Geom.Line,c=n(this._circles);try{for(c.s();!(a=c.n()).done;){var u=a.value;u.points=[],r=new Phaser.Geom.Line(t.origin.x,t.origin.y,u.x,u.y);var d=Math.sqrt(Math.pow(Phaser.Geom.Line.Length(r),2)-Math.pow(u.radius,2)),g=Phaser.Geom.Line.Angle(r),y=Math.asin(u.radius/Phaser.Geom.Line.Length(r));Phaser.Geom.Line.SetToAngle(h,t.origin.x,t.origin.y,g-y,d),Phaser.Geom.Line.SetToAngle(l,t.origin.x,t.origin.y,g+y,d),u.points.push(h.getPointB()),u.points.push(l.getPointB()),i.push(h.getPointB()),i.push(l.getPointB())}}catch(p){c.e(p)}finally{c.f()}}return i}function r(){return this.active?this._segments:[]}function a(){if(!this.active)return this;var t=[],e=[],i=this.object;this._circles=[];var s=new Phaser.Geom.Point;s.x=this.object.x-this.object.displayWidth*this.object.originX,s.y=this.object.y-this.object.displayHeight*this.object.originY;var o=i.rotation;if(this.mapChild)this._updateChildMap(this.mapChild,t,e,o,s);else{i.iterate(function(i){this._updateChildMap(i,t,e,o,s)}.bind(this));for(var r=0,a=i.list.length;r<a;r++){var h=i.list[r],l=h.data.get("raycasterMap");if(l)for(var c=r+1,u=i.list.length;c<u;c++){var d=i.list[c],g=d.data.get("raycasterMap");if(g&&Phaser.Geom.Intersects.RectangleToRectangle(h.getBounds(),d.getBounds())){var y,p=n(l.getSegments());try{for(p.s();!(y=p.n()).done;){var f,m=y.value,b=n(g.getSegments());try{for(b.s();!(f=b.n()).done;){var v=f.value,x=[];if(Phaser.Geom.Intersects.LineToLine(m,v,x))if(0!==o){var P=new Phaser.Geom.Line(i.x,i.y,x.x*i.scaleX+s.x,x.y*i.scaleY+s.y);Phaser.Geom.Line.SetToAngle(P,this.object.x,this.object.y,Phaser.Geom.Line.Angle(P)+o,Phaser.Geom.Line.Length(P)),t.push(P.getPointB())}else t.push(new Phaser.Geom.Point(x.x*i.scaleX+s.x,x.y*i.scaleX+s.y))}}catch(w){b.e(w)}finally{b.f()}}}catch(w){p.e(w)}finally{p.f()}}}}}return this._points=t,this._segments=e,this}function h(t,e,i,s,o){if(t.data||t.setDataEnabled(),!t.data.get("raycasterMapNotSupported")){var r=t.data.get("raycasterMap");if(r)r.updateMap();else{if((r=new this.constructor({object:t,segmentCount:this.segmentCount})).notSupported)return r.destroy(),void t.data.set("raycasterMapNotSupported",!0);t.data.set("raycasterMap",r)}var a,h=[],l=n(r.getPoints(!1,!0));try{for(l.s();!(a=l.n()).done;){var c=a.value,u=void 0;if(0!==s){var d=new Phaser.Geom.Line(this.object.x,this.object.y,c.x*this.object.scaleX+o.x,c.y*this.object.scaleY+o.y);Phaser.Geom.Line.SetToAngle(d,this.object.x,this.object.y,Phaser.Geom.Line.Angle(d)+s,Phaser.Geom.Line.Length(d)),u=d.getPointB()}else u=new Phaser.Geom.Point(c.x*this.object.scaleX+o.x,c.y*this.object.scaleX+o.y);if(u.neighbours=[],h.length>0){var g=h.slice(-1)[0];g.neighbours.push(u),u.neighbours.push(g)}h.push(u),e.push(u)}}catch(G){l.e(G)}finally{l.f()}h.length>0&&h.slice(-1)[0].neighbours.push(h[0]);var y,p=n(r.getSegments());try{for(p.s();!(y=p.n()).done;){var f=y.value;if(0!==s){var m=f.getPointA(),b=f.getPointB(),v=new Phaser.Geom.Line(this.object.x,this.object.y,m.x*this.object.scaleX+o.x,m.y*this.object.scaleY+o.y),x=new Phaser.Geom.Line(this.object.x,this.object.y,b.x*this.object.scaleX+o.x,b.y*this.object.scaleY+o.y);Phaser.Geom.Line.SetToAngle(v,this.object.x,this.object.y,Phaser.Geom.Line.Angle(v)+s,Phaser.Geom.Line.Length(v)),Phaser.Geom.Line.SetToAngle(x,this.object.x,this.object.y,Phaser.Geom.Line.Angle(x)+s,Phaser.Geom.Line.Length(x)),i.push(new Phaser.Geom.Line(v.getPointB().x,v.getPointB().y,x.getPointB().x,x.getPointB().y))}else i.push(new Phaser.Geom.Line(f.getPointA().x*this.object.scaleX+o.x,f.getPointA().y*this.object.scaleY+o.y,f.getPointB().x*this.object.scaleX+o.x,f.getPointB().y*this.object.scaleY+o.y))}}catch(G){p.e(G)}finally{p.f()}if("Arc"==r.type&&0==this.segmentCount){var P=new Phaser.Geom.Point;if(P.x=(r.object.x-r.object.displayWidth*(r.object.originX-.5))*this.object.scaleX+o.x,P.y=(r.object.y-r.object.displayHeight*(r.object.originY-.5))*this.object.scaleY+o.y,0!==s){var w=new Phaser.Geom.Line(this.object.x,this.object.y,P.x,P.y);Phaser.Geom.Line.SetToAngle(w,this.object.x,this.object.y,Phaser.Geom.Line.Angle(w)+s,Phaser.Geom.Line.Length(w)),P=w.getPointB()}this._circles.push(new Phaser.Geom.Circle(P.x,P.y,r.object.radius*r.object.scaleX*this.object.scaleX))}else if("Container"===r.type){var S,M=n(r._circles);try{for(M.s();!(S=M.n()).done;){var j=S.value,B=new Phaser.Geom.Point;if(B.x=j.x*this.object.scaleX+o.x,B.y=j.y*this.object.scaleY+o.y,0!==s){var C=new Phaser.Geom.Line(this.object.x,this.object.y,B.x,B.y);Phaser.Geom.Line.SetToAngle(C,this.object.x,this.object.y,Phaser.Geom.Line.Angle(C)+s,Phaser.Geom.Line.Length(C)),B=C.getPointB()}this._circles.push(new Phaser.Geom.Circle(B.x,B.y,j.radius*this.object.scaleX))}}catch(G){M.e(G)}finally{M.f()}}}}i.r(e),i.d(e,{_updateChildMap:function(){return h},getPoints:function(){return o},getSegments:function(){return r},updateMap:function(){return a}})},465:function(t,e,i){function n(t,e){return this._raycaster=e||!1,this.type,this.active,this._dynamic=!1,this.circle=!1,this.object,this._points=[],this._segments=[],this.getPoints,this.getSegments,this.getBoundingBox,this.updateMap,this.config(t),this.notSupported||this.updateMap(),this}i.d(e,{T:function(){return n}}),n.prototype={config:i(197).$,destroy:i(385).z,get dynamic(){return this._dynamic},set dynamic(t){if(this._dynamic==t)return this;if(t)this._dynamic=!0,this._raycaster&&(this._raycaster.dynamicMappedObjects.push(this.object),this._raycaster._stats.mappedObjects.dynamic=this._raycaster.dynamicMappedObjects.length,this._raycaster._stats.mappedObjects.static=this._raycaster._stats.mappedObjects.total-this._raycaster._stats.mappedObjects.dynamic);else if(this._dynamic=!1,this._raycaster){var e=this._raycaster.dynamicMappedObjects.indexOf(this.object);e>=0&&this._raycaster.dynamicMappedObjects.splice(e,1),this._raycaster._stats.mappedObjects.dynamic=this._raycaster.dynamicMappedObjects.length,this._raycaster._stats.mappedObjects.static=this._raycaster._stats.mappedObjects.total-this._raycaster._stats.mappedObjects.dynamic}return this}},n.prototype.constructor=n},919:function(t,e,i){function n(){return this.active?this._points:[]}function s(){return this.active?this._segments:[]}function o(){if(!this.active)return this;var t=[],e=[],i=new Phaser.Geom.Point;i.x=this.object.x-this.object.displayWidth*this.object.originX,i.y=this.object.y-this.object.displayHeight*this.object.originY;var n=this.object.geom.getPointA(),s=this.object.geom.getPointB(),o=this.object.rotation;if(0!==o){var r=new Phaser.Geom.Line(this.object.x,this.object.y,n.x*this.object.scaleX+i.x,n.y*this.object.scaleY+i.y);Phaser.Geom.Line.SetToAngle(r,this.object.x,this.object.y,Phaser.Geom.Line.Angle(r)+o,Phaser.Geom.Line.Length(r)),n=r.getPointB();var a=new Phaser.Geom.Line(this.object.x,this.object.y,s.x*this.object.scaleX+i.x,s.y*this.object.scaleY+i.y);Phaser.Geom.Line.SetToAngle(a,this.object.x,this.object.y,Phaser.Geom.Line.Angle(a)+o,Phaser.Geom.Line.Length(a)),s=a.getPointB(),t.push(new Phaser.Geom.Point(n.x,n.y)),t.push(new Phaser.Geom.Point(s.x,s.y)),e.push(new Phaser.Geom.Line(n.x,n.y,s.x,s.y))}else t.push(new Phaser.Geom.Point(n.x*this.object.scaleX+i.x,n.y*this.object.scaleY+i.y)),t.push(new Phaser.Geom.Point(s.x*this.object.scaleX+i.x,s.y*this.object.scaleY+i.y)),e.push(new Phaser.Geom.Line(n.x*this.object.scaleX+i.x,n.y*this.object.scaleY+i.y,s.x+i.x*this.object.scaleX,s.y*this.object.scaleY+i.y));return t[0].neighbours=[t[1]],t[1].neighbours=[t[0]],this._points=t,this._segments=e,this}i.r(e),i.d(e,{getPoints:function(){return n},getSegments:function(){return s},updateMap:function(){return o}})},216:function(t,e,i){function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function s(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active)return[];var e="body"===this.object.type||"composite"===this.object.type?this.object:this.object.body;if(t&&!this.forceVerticesMapping&&e.circleRadius>0){var i=[],n=new Phaser.Geom.Line,s=new Phaser.Geom.Line,o=new Phaser.Geom.Line(t.origin.x,t.origin.y,e.position.x,e.position.y),r=Math.sqrt(Math.pow(Phaser.Geom.Line.Length(o),2)-Math.pow(e.circleRadius*e.scale.x,2)),a=Phaser.Geom.Line.Angle(o),h=Math.asin(e.circleRadius*e.scale.x/Phaser.Geom.Line.Length(o));return Phaser.Geom.Line.SetToAngle(n,t.origin.x,t.origin.y,a-h,r),Phaser.Geom.Line.SetToAngle(s,t.origin.x,t.origin.y,a+h,r),i.push(n.getPointB(),s.getPointB()),i}return this._points}function o(){return this.active?this._segments:[]}function r(){if(!this.active)return this;var t=[],e=[],i="body"===this.object.type||"composite"===this.object.type?this.object:this.object.body,s=[i],o=!1;if(i.circleRadius>0&&!this.forceVerticesMapping)return this.circle=!0,this._points=t,this._segments=e,this;this.circle=!1,"composite"==i.type&&(s=i.bodies),(void 0===i.bounds&&"composite"==i.type||"composite"==i.type&&this.dynamic)&&(o=!0);var r,a=function(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return n(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?n(t,e):void 0}}(t))||e){i&&(t=i);var s=0,o=function(){};return{s:o,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}(s);try{for(a.s();!(r=a.n()).done;){var h=r.value;if(1===h.parts.length||this.forceConvex){var l=h.parts[0].vertices;t.push(new Phaser.Geom.Point(l[0].x,l[0].y)),t[0].neighbours=[];for(var c=1,u=l.length;c<u;c++){var d=t.slice(-1)[0],g=new Phaser.Geom.Point(l[c].x,l[c].y);d.neighbours||(d.neighbours=[]),d.neighbours.push(g),g.neighbours=[d],t.push(g);var y=new Phaser.Geom.Line(d.x,d.y,g.x,g.y);e.push(y)}var p=new Phaser.Geom.Line(l[l.length-1].x,l[l.length-1].y,l[0].x,l[0].y);e.push(p),t[0].neighbours.push(t.slice(-1)[0])}else{for(var f=[],m=[],b=1,v=h.parts.length;b<v;b++){for(var x=h.parts[b].vertices,P=[],w=0,S=x.length;w<S;w++){var M=new Phaser.Geom.Point(x[w].x,x[w].y);if(P.length){var j=P.slice(-1)[0];M.neighbours=[j],j.neighbours.push(M)}else M.neighbours=[];var B=x[w].x+"/"+x[w].y;void 0===m[B]?(t.push(M),m[B]=M):(m[B].neighbours.push(M),M.neighbours.push(m[B])),P.push(M),x[w].isInternal&&(f.push(P),P=[])}f.push(P)}for(var C=0,G=f;C<G.length;C++){var A,L=G[C],_=0;for(_=0,A=L.length-1;_<A;_++)e.push(new Phaser.Geom.Line(L[_].x,L[_].y,L[_+1].x,L[_+1].y))}}}}catch(O){a.e(O)}finally{a.f()}if(this._points=t,this._segments=e,o){var T=this._raycaster.scene.matter.composite.bounds(i);i.bounds=T}return this}function a(){var t="body"===this.object.type||"composite"===this.object.type?this.object.bounds:this.object.body.bounds;return new Phaser.Geom.Rectangle(t.min.x,t.min.y,t.max.x-t.min.x,t.max.y-t.min.y)}i.r(e),i.d(e,{getBoundingBox:function(){return a},getPoints:function(){return s},getSegments:function(){return o},updateMap:function(){return r}})},645:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){return this.active?this._points:[]}function r(){return this.active?this._segments:[]}function a(){if(!this.active)return this;var t=[],e=[],i=new Phaser.Geom.Point;i.x=this.object.x-this.object.displayWidth*this.object.originX,i.y=this.object.y-this.object.displayHeight*this.object.originY;var s=this.object.rotation;if(0!==s){var o,r=n(this.object.geom.points);try{for(r.s();!(o=r.n()).done;){var a=o.value,h=new Phaser.Geom.Line(this.object.x,this.object.y,a.x*this.object.scaleX+i.x,a.y*this.object.scaleY+i.y);Phaser.Geom.Line.SetToAngle(h,this.object.x,this.object.y,Phaser.Geom.Line.Angle(h)+s,Phaser.Geom.Line.Length(h)),t.push(h.getPointB())}}catch(b){r.e(b)}finally{r.f()}}else{var l,c=n(this.object.geom.points);try{for(c.s();!(l=c.n()).done;){var u=l.value;t.push(new Phaser.Geom.Point(u.x*this.object.scaleX+i.x,u.y*this.object.scaleY+i.y))}}catch(b){c.e(b)}finally{c.f()}}for(var d=0,g=t.length;d<g;d++){var y=d>0?t[d-1]:t.slice(-1)[0],p=d<g-1?t[d+1]:t[0];e.push(new Phaser.Geom.Line(t[d].x,t[d].y,p.x,p.y)),t[d].neighbours=[y,p]}for(var f=0,m=t.length;f<m;f++)f+1<m&&e.push(new Phaser.Geom.Line(t[f].x,t[f].y,t[f+1].x,t[f+1].y));return this.object.closePath||(e.pop(),t[0].neighbours.shift(),t[t.length-1].neighbours.pop()),this._points=t,this._segments=e,this}i.r(e),i.d(e,{getPoints:function(){return o},getSegments:function(){return r},updateMap:function(){return a}})},502:function(t,e,i){function n(){return this.active?this._points:[]}function s(){return this.active?this._segments:[]}function o(){if(!this.active)return this;for(var t=[],e=[],i=0,n=(t=[this.object.getTopLeft(),this.object.getTopRight(),this.object.getBottomRight(),this.object.getBottomLeft()]).length;i<n;i++){var s=i>0?t[i-1]:t.slice(-1)[0],o=i<n-1?t[i+1]:t[0];e.push(new Phaser.Geom.Line(t[i].x,t[i].y,o.x,o.y)),t[i].neighbours=[s,o]}return this._points=t,this._segments=e,this}i.r(e),i.d(e,{getPoints:function(){return n},getSegments:function(){return s},updateMap:function(){return o}})},265:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active)return[];if(!t||t&&(0==t.detectionRange||t.detectionRange>=Phaser.Math.MAX_SAFE_INTEGER))return this._points;var e,i=[],s=n(this._points);try{for(s.s();!(e=s.n()).done;){var o=e.value;Phaser.Math.Distance.Between(t.origin.x,t.origin.y,o.x,o.y)<=t.detectionRange&&i.push(o)}}catch(l){s.e(l)}finally{s.f()}var r,a=n(this.getSegments(t));try{for(a.s();!(r=a.n()).done;){var h=r.value;Phaser.Math.Distance.Between(t.origin.x,t.origin.y,h.x1,h.y1)>t.detectionRange&&i.push(new Phaser.Geom.Point(h.x1,h.y1)),Phaser.Math.Distance.Between(t.origin.x,t.origin.y,h.x2,h.y2)>t.detectionRange&&i.push(new Phaser.Geom.Point(h.x2,h.y2))}}catch(l){a.e(l)}finally{a.f()}return i}function r(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this.active)return[];if(!t||t&&(0==t.detectionRange||t.detectionRange>=Phaser.Math.MAX_SAFE_INTEGER))return this._segments;var e,i=[],s=n(this._segments);try{for(s.s();!(e=s.n()).done;){var o=e.value;Phaser.Geom.Intersects.LineToCircle(o,t.detectionRangeCircle)&&i.push(o)}}catch(r){s.e(r)}finally{s.f()}return i}function a(){if(!this.active)return this;for(var t=[],e=[],i=Array(this.object.layer.data[0].length+1),n=0,s=i.length;n<s;n++)i[n]=[];var o,r,a=new Phaser.Geom.Point(this.object.x,this.object.y),h=this.object.layer.data[0],l=this.object.layer.tileWidth*this.object.scaleX,c=this.object.layer.tileHeight*this.object.scaleY;this.collisionTiles.includes(h[0].index)&&(o=new Phaser.Geom.Point(a.x,a.y),r=new Phaser.Geom.Point(l+a.x,a.y),i[0].push(o));for(var u=1,d=h.length;u<d;u++){var g=h[u];if(this.collisionTiles.includes(g.index)){var y=u*l+a.x,p=a.y;o||(o=new Phaser.Geom.Point(y,p),i[u].push(o)),r?r.x=y+l:r=new Phaser.Geom.Point(y+l,p)}else o&&(o.neighbours=[r],r.neighbours=[o],t.push(o,r),e.push(new Phaser.Geom.Line(o.x,o.y,r.x,r.y)),i[u].push(r),o=!1,r=!1)}o&&(o.neighbours=[r],r.neighbours=[o],t.push(o,r),e.push(new Phaser.Geom.Line(o.x,o.y,r.x,r.y)),i[h.length].push(r)),o=!1,r=!1;for(var f=1,m=this.object.layer.data.length;f<m;f++){h=this.object.layer.data[f];var b=this.object.layer.data[f-1];this.collisionTiles.includes(h[0].index)!=this.collisionTiles.includes(b[0].index)&&(o=new Phaser.Geom.Point(a.x,f*c+a.y),r=new Phaser.Geom.Point(l+a.x,f*c+a.y),i[0].push(o));for(var v=1,x=h.length;v<x;v++){var P=h[v];if(this.collisionTiles.includes(P.index)!=this.collisionTiles.includes(b[v].index)){var w=v*l+a.x,S=f*c+a.y;o||(o=new Phaser.Geom.Point(w,S),i[v].push(o)),r?r.x=w+l:r=new Phaser.Geom.Point(w+l,S)}else o&&(o.neighbours=[r],r.neighbours=[o],t.push(o,r),e.push(new Phaser.Geom.Line(o.x,o.y,r.x,r.y)),i[v].push(r),o=!1,r=!1)}o&&(o.neighbours=[r],r.neighbours=[o],t.push(o,r),e.push(new Phaser.Geom.Line(o.x,o.y,r.x,r.y)),i[h.length].push(r)),o=!1,r=!1}h=this.object.layer.data.slice(-1)[0];var M=this.object.layer.data.length*c+a.y;this.collisionTiles.includes(h[0].index)&&(o=new Phaser.Geom.Point(a.x,M),r=new Phaser.Geom.Point(l+a.x,M),i[0].push(o));for(var j=1,B=h.length;j<B;j++){var C=h[j];if(this.collisionTiles.includes(C.index)){var G=j*l+a.x;o||(o=new Phaser.Geom.Point(G,M),i[j].push(o)),r?r.x=G+l:r=new Phaser.Geom.Point(G+l,M)}else o&&(o.neighbours=[r],r.neighbours=[o],t.push(o,r),e.push(new Phaser.Geom.Line(o.x,o.y,r.x,r.y)),i[j].push(r),o=!1,r=!1)}o&&(o.neighbours=[r],r.neighbours=[o],t.push(o,r),e.push(new Phaser.Geom.Line(o.x,o.y,r.x,r.y)),i[h.length].push(r));for(var A=0,L=i.length;A<L;A++)for(var _=i[A],T=0,O=_.length-1;T<O;T++)e.push(new Phaser.Geom.Line(_[T].x,_[T].y,_[T+1].x,_[T+1].y)),_[T].neighbours.push(_[T+1]),_[T+1].neighbours.push(_[T]),T++;return this._points=t,this._segments=e,this}function h(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return this.collisionTiles=t,this}i.r(e),i.d(e,{getPoints:function(){return o},getSegments:function(){return r},setCollisionTiles:function(){return h},updateMap:function(){return a}})},458:function(t,e,i){function n(t){return this.segmentCount=t,this.circle=!t,this.updateMap(),this}i.r(e),i.d(e,{setSegmentCount:function(){return n}})},822:function(t,e,i){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.angle=Phaser.Math.Angle.Normalize(t),Phaser.Geom.Line.SetToAngle(this._ray,this.origin.x,this.origin.y,this.angle,this.rayRange),this}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.angle=Phaser.Math.Angle.Normalize(Phaser.Math.DegToRad(t)),Phaser.Geom.Line.SetToAngle(this._ray,this.origin.x,this.origin.y,this.angle,this.rayRange),this}i.d(e,{O:function(){return s},S:function(){return n}})},974:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){var t,e,i,s=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=this.rayRange,r=!!s.internal&&s.internal,a=performance.now(),h={method:"cast",rays:1,testedMappedObjects:0,hitMappedObjects:0,segments:0,time:0};if(this._raycaster&&this._raycaster.boundingBox){var l=[];if(Phaser.Geom.Intersects.GetLineToRectangle(this._ray,this._raycaster.boundingBox.rectangle,l),1===l.length)t=l[0];else if(l.length>1){var c,u=n(l);try{for(u.s();!(c=u.n()).done;){var d=c.value,g=Phaser.Math.Distance.Between(this.origin.x,this.origin.y,d.x,d.y);g<o&&(o=g,t=d)}}catch(rt){u.e(rt)}finally{u.f()}}else if(s.target){var y=Phaser.Math.Distance.Between(this.origin.x,this.origin.y,s.target.x,s.target.y);this.rayRange>y&&(o=y,t=s.target)}}if(!s.objects){if(!this._raycaster)return intersections;s.objects=this._raycaster.mappedObjects}var p,f,m=n(s.objects);try{for(m.s();!(p=m.n()).done;){var b=p.value,v=void 0,x=void 0,P=[],w=!1;if(v="body"===b.type||"composite"===b.type?b.raycasterMap:b.data.get("raycasterMap"),h.testedMappedObjects++,r?x=v._boundingBox:(x=v.getBoundingBox()).setTo(x.x-.1,x.y-.1,x.width+.2,x.height+.2),0!==Phaser.Geom.Intersects.GetLineToRectangle(this._ray,x,P).length){if(Phaser.Geom.Rectangle.ContainsPoint(x,this.origin))w=!0;else{var S,M=n(P);try{for(M.s();!(S=M.n()).done;){var j=S.value;if(Phaser.Math.Distance.Between(this.origin.x,this.origin.y,j.x,j.y)<o){w=!0;break}}}catch(rt){M.e(rt)}finally{M.f()}}if(w){h.hitMappedObjects++,h.segments+=v.getSegments(this).length;var B,C=n(v.getSegments(this));try{for(C.s();!(B=C.n()).done;){var G=B.value,A=[];if(s.target){if(Phaser.Geom.Point.Equals(s.target,G.getPointA())||Phaser.Geom.Point.Equals(s.target,G.getPointB()))A=s.target;else if(!Phaser.Geom.Intersects.LineToLine(this._ray,G,A))continue}else if(!Phaser.Geom.Intersects.LineToLine(this._ray,G,A))continue;var L=Phaser.Math.Distance.Between(this.origin.x,this.origin.y,A.x,A.y);L<o&&(o=L,t=A,i=v.object,e=G)}}catch(rt){C.e(rt)}finally{C.f()}if(v.circle){if(v._points.length>0)continue;if(s.target){var _,T=v.getPoints(this),O=!1,R=n(T);try{for(R.s();!(_=R.n()).done;){var I=_.value;if(Phaser.Geom.Point.Equals(s.target,I)){var E=Phaser.Math.Distance.Between(this.origin.x,this.origin.y,I.x,I.y);if(E<o){o=E,t=I,i=v.object,O=!0;break}}}}catch(rt){R.e(rt)}finally{R.f()}if(O)continue}var k=[],D=new Phaser.Geom.Point;D.x=v.object.x-v.object.displayWidth*(v.object.originX-.5),D.y=v.object.y-v.object.displayHeight*(v.object.originY-.5);var z=v.object.rotation;if(0!==z){var X=new Phaser.Geom.Line(v.object.x,v.object.y,D.x,D.y);Phaser.Geom.Line.SetToAngle(X,v.object.x,v.object.y,Phaser.Geom.Line.Angle(X)+z,Phaser.Geom.Line.Length(X));var N=X.getPointB();D.x=N.x,D.y=N.y}var U=new Phaser.Geom.Circle(D.x,D.y,v.object.radius*v.object.scaleX);if(Phaser.Geom.Intersects.GetLineToCircle(this._ray,U,k)){var F,W=n(k);try{for(W.s();!(F=W.n()).done;){var Y=F.value,H=Phaser.Math.Distance.Between(this._ray.x1,this._ray.y1,Y.x,Y.y);H<o&&(o=H,t=Y,i=v.object)}}catch(rt){W.e(rt)}finally{W.f()}}}if("Container"==v.type&&v._circles.length>0){var q,$=n(v._circles);try{for($.s();!(q=$.n()).done;){var V=q.value;if(s.target){var K,Z=!1,J=n(V.points);try{for(J.s();!(K=J.n()).done;){var Q=K.value;if(Phaser.Geom.Point.Equals(s.target,Q)){var tt=Phaser.Math.Distance.Between(this.origin.x,this.origin.y,Q.x,Q.y);if(tt<o){o=tt,t=Q,i=v.object,Z=!0;break}}}}catch(rt){J.e(rt)}finally{J.f()}if(Z)continue}var et=[];if(Phaser.Geom.Intersects.GetLineToCircle(this._ray,V,et)){var it,nt=n(et);try{for(nt.s();!(it=nt.n()).done;){var st=it.value,ot=Phaser.Math.Distance.Between(this._ray.x1,this._ray.y1,st.x,st.y);ot<o&&(o=ot,t=st,i=v.object)}}catch(rt){nt.e(rt)}finally{nt.f()}}}}catch(rt){$.e(rt)}finally{$.f()}}}}}}catch(rt){m.e(rt)}finally{m.f()}if(r?(this._stats.rays++,this._stats.testedMappedObjects+=h.testedMappedObjects,this._stats.hitMappedObjects+=h.hitMappedObjects,this._stats.segments+=h.segments):(h.time=performance.now()-a,this._stats=h),t)(f=new Phaser.Geom.Point(t.x,t.y)).segment=e,f.object=i;else{if(this.ignoreNotIntersectedRays)return!1;f=this._ray.getPointB()}return this.round&&(f.x=Math.round(f.x),f.y=Math.round(f.y)),r||this.drawDebug([f]),f}i.d(e,{w:function(){return o}})},506:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=this.angle,i=[],s=[],o=[],r=performance.now();if(this._stats={method:"castCircle",rays:0,testedMappedObjects:0,hitMappedObjects:0,segments:0,time:0},!t.objects){if(!this._raycaster)return i;t.objects=this._raycaster.mappedObjects}if(this._raycaster&&this._raycaster.boundingBox){var a,h=n(this._raycaster.boundingBox.points);try{for(h.s();!(a=h.n()).done;){var l=a.value;s.push({point:l,angle:Phaser.Math.Angle.Between(this.origin.x,this.origin.y,l.x,l.y)})}}catch(F){h.e(F)}finally{h.f()}}for(var c=0,u=t.objects.length;c<u;c++){var d=t.objects[c];if(this.boundsInRange(d)){o.push(d);var g=void 0,y=void 0;(y=(g="body"===d.type||"composite"===d.type?d.raycasterMap:d.data.get("raycasterMap")).getBoundingBox()).setTo(y.x-.1,y.y-.1,y.width+.2,y.height+.2),g._boundingBox=y;var p,f=n(g.getPoints(this));try{for(f.s();!(p=f.n()).done;){var m=p.value;s.push({point:m,angle:Phaser.Math.Angle.Between(this.origin.x,this.origin.y,m.x,m.y)})}}catch(F){f.e(F)}finally{f.f()}for(var b=c+1,v=t.objects.length;b<v;b++){var x=t.objects[b],P=void 0;if(P="body"===x.type||"composite"===x.type?x.raycasterMap:x.data.get("raycasterMap"),Phaser.Geom.Intersects.RectangleToRectangle(g.getBoundingBox(),P.getBoundingBox())){var w,S=n(g.getSegments(this));try{for(S.s();!(w=S.n()).done;){var M,j=w.value,B=n(P.getSegments(this));try{for(B.s();!(M=B.n()).done;){var C=M.value,G=[];if(Phaser.Geom.Intersects.LineToLine(j,C,G)){var A={point:new Phaser.Geom.Point(G.x,G.y),angle:Phaser.Math.Angle.Between(this.origin.x,this.origin.y,G.x,G.y)};A.point.intersection=!1,s.push(A)}}}catch(F){B.e(F)}finally{B.f()}}}catch(F){S.e(F)}finally{S.f()}}}}}s.sort(function(t,e){return t.angle==e.angle?Phaser.Math.Distance.Between(this.origin.x,this.origin.y,t.point.x,t.point.y)>Phaser.Math.Distance.Between(this.origin.x,this.origin.y,e.point.x,e.point.y)?1:-1:t.angle-e.angle}.bind(this));for(var L={angle:!1},_=0,T=s;_<T.length;_++){var O=T[_];if(O.angle!==L.angle){L=O,this.setAngle(O.angle);var R=this.cast({objects:o,target:O.point,internal:!0});if(R){var I=!1;if(this.round){var E=new Phaser.Geom.Point(Math.round(O.point.x),Math.round(O.point.y));I=Phaser.Geom.Point.Equals(E,R)}else I=Phaser.Geom.Point.Equals(O.point,R);if(I)if(!O.point.neighbours||O.point.neighbours.length<2);else if(Phaser.Math.Angle.Normalize(this.angle-Phaser.Math.Angle.BetweenPoints(this.origin,O.point.neighbours[0]))<1e-4||Phaser.Math.Angle.Normalize(this.angle-Phaser.Math.Angle.BetweenPoints(this.origin,O.point.neighbours[1]))<1e-4);else{var k=[];O.point.neighboursTriangle||(O.point.neighboursTriangle=new Phaser.Geom.Triangle(O.point.x,O.point.y,O.point.neighbours[0].x,O.point.neighbours[0].y,O.point.neighbours[1].x,O.point.neighbours[1].y)),Phaser.Geom.Intersects.GetTriangleToLine(O.point.neighboursTriangle,this._ray,k);for(var D=0,z=k;D<z.length;D++){var X=z[D];if(Math.abs(O.point.x-X.x)>1e-4&&Math.abs(O.point.y-X.y)>1e-4){I=!1;break}}}if(I){this.setAngle(O.angle-1e-4);var N=this.cast({objects:o,internal:!0});N&&i.push(N),i.push(R),this.setAngle(O.angle+1e-4);var U=this.cast({objects:o,internal:!0});U&&i.push(U);continue}i.push(R)}}}return this.setAngle(e),this.intersections=i,this.autoSlice&&(this.slicedIntersections=this.slice()),this._stats.time=performance.now()-r,this.drawDebug(i),i}i.d(e,{I:function(){return o}})},757:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(){var t,e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=this.angle,o=[],r=[],a=[],h=this.cone,l=performance.now();if(this._stats={method:"castCone",rays:0,testedMappedObjects:0,hitMappedObjects:0,segments:0,time:0},void 0!==i.cone&&(h=i.cone),void 0!==i.coneDeg&&(h=Phaser.Math.DegToRad(i.coneDeg)),t=this.angle-h/2,e=this.angle+h/2,this.setAngle(t),r.push({point:this._ray.getPointB(),angle:t,angleOffsetDeg:Phaser.Math.RadToDeg(-h/2)}),this.setAngle(e),r.push({point:this._ray.getPointB(),angle:e,angleOffsetDeg:Phaser.Math.RadToDeg(h/2)}),!i.objects){if(!this._raycaster)return o;i.objects=this._raycaster.mappedObjects}if(this._raycaster&&this._raycaster.boundingBox){var c,u=n(this._raycaster.boundingBox.points);try{for(u.s();!(c=u.n()).done;){var d=c.value,g=Phaser.Math.Angle.Between(this.origin.x,this.origin.y,d.x,d.y),y=Phaser.Math.Angle.ShortestBetween(Phaser.Math.RadToDeg(g),Phaser.Math.RadToDeg(s));Math.abs(y)<Phaser.Math.RadToDeg(h/2)&&r.push({point:d,angle:g,angleOffsetDeg:-y})}}catch(Z){u.e(Z)}finally{u.f()}}for(var p=0,f=i.objects.length;p<f;p++){var m=i.objects[p];if(this.boundsInRange(m)){a.push(m);var b=void 0,v=void 0;(v=(b="body"===m.type||"composite"===m.type?m.raycasterMap:m.data.get("raycasterMap")).getBoundingBox()).setTo(v.x-.1,v.y-.1,v.width+.2,v.height+.2),b._boundingBox=v;var x,P=n(b.getPoints(this));try{for(P.s();!(x=P.n()).done;){var w=x.value,S=Phaser.Math.Angle.Between(this.origin.x,this.origin.y,w.x,w.y),M=Phaser.Math.Angle.ShortestBetween(Phaser.Math.RadToDeg(S),Phaser.Math.RadToDeg(s));Math.abs(M)<Phaser.Math.RadToDeg(h/2)&&r.push({point:w,angle:Phaser.Math.Angle.Between(this.origin.x,this.origin.y,w.x,w.y),angleOffsetDeg:-M})}}catch(Z){P.e(Z)}finally{P.f()}for(var j=p+1,B=i.objects.length;j<B;j++){var C=i.objects[j],G=void 0;if(G="body"===C.type||"composite"===C.type?C.raycasterMap:C.data.get("raycasterMap"),Phaser.Geom.Intersects.RectangleToRectangle(b.getBoundingBox(),G.getBoundingBox())){var A,L=n(b.getSegments(this));try{for(L.s();!(A=L.n()).done;){var _,T=A.value,O=n(G.getSegments(this));try{for(O.s();!(_=O.n()).done;){var R=_.value,I=[];if(Phaser.Geom.Intersects.LineToLine(T,R,I)){var E=Phaser.Math.Angle.Between(this.origin.x,this.origin.y,I.x,I.y),k=Phaser.Math.Angle.ShortestBetween(Phaser.Math.RadToDeg(E),Phaser.Math.RadToDeg(s));Math.abs(k)<Phaser.Math.RadToDeg(h/2)&&r.push({point:new Phaser.Geom.Point(I.x,I.y),angle:Phaser.Math.Angle.Between(this.origin.x,this.origin.y,I.x,I.y),angleOffsetDeg:-k})}}}catch(Z){O.e(Z)}finally{O.f()}}}catch(Z){L.e(Z)}finally{L.f()}}}}}r.sort(function(t,e){return t.angle==e.angle?Phaser.Math.Distance.Between(this.origin.x,this.origin.y,t.point.x,t.point.y)>Phaser.Math.Distance.Between(this.origin.x,this.origin.y,e.point.x,e.point.y)?1:-1:t.angleOffsetDeg-e.angleOffsetDeg}.bind(this));for(var D={angle:!1},z=0,X=r;z<X.length;z++){var N=X[z];if(N.angle!==D.angle){D=N,this.setAngle(N.angle);var U=this.cast({objects:a,target:N.point,internal:!0});if(U){var F=!1;if(this.round){var W=new Phaser.Geom.Point(Math.round(N.point.x),Math.round(N.point.y));F=Phaser.Geom.Point.Equals(W,U)}else F=Phaser.Geom.Point.Equals(N.point,U);if(F)if(!N.point.neighbours||N.point.neighbours.length<2);else if(Phaser.Math.Angle.Normalize(this.angle-Phaser.Math.Angle.BetweenPoints(this.origin,N.point.neighbours[0]))<1e-4||Phaser.Math.Angle.Normalize(this.angle-Phaser.Math.Angle.BetweenPoints(this.origin,N.point.neighbours[1]))<1e-4);else{var Y=[];N.point.neighboursTriangle||(N.point.neighboursTriangle=new Phaser.Geom.Triangle(N.point.x,N.point.y,N.point.neighbours[0].x,N.point.neighbours[0].y,N.point.neighbours[1].x,N.point.neighbours[1].y)),Phaser.Geom.Intersects.GetTriangleToLine(N.point.neighboursTriangle,this._ray,Y);for(var H=0,q=Y;H<q.length;H++){var $=q[H];if(Math.abs(N.point.x-$.x)>1e-4&&Math.abs(N.point.y-$.y)>1e-4){F=!1;break}}}if(F){this.setAngle(N.angle-1e-4);var V=this.cast({objects:a,internal:!0});V&&o.push(V),o.push(U),this.setAngle(N.angle+1e-4);var K=this.cast({objects:a,internal:!0});K&&o.push(K);continue}o.push(U)}}}return this.setAngle(s),this.intersections=o,this.autoSlice&&(this.slicedIntersections=this.slice(o,!1)),this._stats.time=performance.now()-l,this.drawDebug(o),o}i.d(e,{d:function(){return o}})},582:function(t,e,i){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.cone=t,this}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.cone=Phaser.Math.DegToRad(t),this}i.d(e,{M:function(){return n},U:function(){return s}})},807:function(t,e,i){function n(t){return this.object=t.object,void 0!==t.origin&&this.origin.setTo(t.origin.x,t.origin.y),void 0!==t.angle&&(this.angle=Phaser.Math.Angle.Normalize(t.angle)),void 0!==t.angleDeg&&(this.angle=Phaser.Math.Angle.Normalize(Phaser.Math.DegToRad(t.angleDeg))),void 0!==t.cone&&(this.cone=t.cone),void 0!==t.coneDeg&&(this.cone=Phaser.Math.DegToRad(t.coneDeg)),void 0!==t.rayRange&&(this.rayRange=t.rayRange),void 0!==t.collisionRange&&(this.collisionRange=t.collisionRange),void 0!==t.detectionRange&&(this.detectionRange=t.detectionRange),void 0!==t.ignoreNotIntersectedRays&&(this.ignoreNotIntersectedRays=1==t.ignoreNotIntersectedRays),void 0!==t.round&&(this.round=1==t.round),void 0!==t.autoSlice&&(this.autoSlice=1==t.autoSlice),void 0!==t.enablePhysics&&t.enablePhysics&&this.enablePhysics(t.enablePhysics),Phaser.Geom.Line.SetToAngle(this._ray,this.origin.x,this.origin.y,this.angle,this.rayRange),this.detectionRangeCircle.setTo(this.origin.x,this.origin.y,this.detectionRange),this._raycaster.debugOptions.enabled&&void 0!==this._raycaster.scene&&(this.graphics=this._raycaster.scene.add.graphics({lineStyle:{width:1,color:65280},fillStyle:{color:16711935}}),this.graphics.setDepth(1e3)),this}i.d(e,{$:function(){return n}})},882:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(t){if(void 0===this.graphics||!this._raycaster.debugOptions.enabled)return this;if(this.graphics.clear(),!this._raycaster.debugOptions.rays)return this;if(this._raycaster.debugOptions.graphics.ray){this.graphics.lineStyle(1,this._raycaster.debugOptions.graphics.ray);var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var s=e.value;this.graphics.strokeLineShape({x1:this.origin.x,y1:this.origin.y,x2:s.x,y2:s.y})}}catch(h){i.e(h)}finally{i.f()}}if(this._raycaster.debugOptions.graphics.rayPoint){this.graphics.fillStyle(this._raycaster.debugOptions.graphics.rayPoint),this.graphics.fillPoint(this.origin.x,this.origin.y,3);var o,r=n(t);try{for(r.s();!(o=r.n()).done;){var a=o.value;this.graphics.fillPoint(a.x,a.y,3)}}catch(h){r.e(h)}finally{r.f()}}return this}i.d(e,{s:function(){return o}})},487:function(t,e,i){function n(){for(var t in this.graphics&&this.graphics.destroy(),this)delete this[t]}i.d(e,{z:function(){return n}})},181:function(t,e,i){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"arcade";if(void 0!==this.body)return this;if(this.collisionCircle=this._raycaster.scene.add.circle(this.origin.x,this.origin.y,this.collisionRange),this.collisionCircle._ray=this,"matter"===t){if(this.bodyType="matter",this.collisionRange==Phaser.Math.MAX_SAFE_INTEGER){var e=this._raycaster.boundingBox;this._raycaster.scene.matter.add.gameObject(this.collisionCircle,{shape:{type:"rectangle",x:e.rectangle.centerX,y:e.rectangle.centerY,width:e.rectangle.width,height:e.rectangle.height},label:"phaser-raycaster-ray-body",isSensor:!0,ignoreGravity:!0})}else this._raycaster.scene.matter.add.gameObject(this.collisionCircle,{shape:{type:"circle"},label:"phaser-raycaster-ray-body",isSensor:!0,ignoreGravity:!0});this.body=this.collisionCircle.body,this.body._ray=this,this.setOnCollideActive()}else this.bodyType="arcade",this._raycaster.scene.physics.add.existing(this.collisionCircle),this.body=this.collisionCircle.body,this.body.setCircle(this.collisionRange).setAllowGravity(!1).setImmovable(!0),this.body._ray=this;return this}i.d(e,{z:function(){return n}})},127:function(t,e,i){function n(t){return this.body.collisionFilter.category=t,this}function s(t){return this.body.collisionFilter.group=t,this}function o(t){var e=0;if(Array.isArray(t))for(var i=0;i<t.length;i++)e|=t[i];else e=t;return this.body.collisionFilter.mask=e,this}function r(t){var e=this;return this.body.onCollideCallback=function(i){i.rayCollided?t(i):e.processOverlap(i)&&(i.rayCollided=!0,t(i))},this}function a(t){return this.body.onCollideEndCallback=function(e){e.rayCollided&&(e.rayCollided=!1,t(e))},this}function h(t){var e=this;return this.body.onCollideActiveCallback=function(i){if(e.processOverlap(i)){var n="phaser-raycaster-ray-body"===i.bodyA.label?i.bodyB:i.bodyA;!0!==i.rayCollided&&(i.rayCollided=!0,e.body.onCollideCallback&&e.body.onCollideCallback(i),void 0!==e.body.onCollideWith&&e.body.onCollideWith[n.id]&&e.body.onCollideWith[n.id](n,i)),t&&t(i)}else e.body.onCollideEndCallback&&!0===i.rayCollided&&e.body.onCollideEndCallback(i)},this}function l(t,e){var i=this,n=function(t,n){n.rayCollided?e(t,n):i.processOverlap(n)&&(n.rayCollided=!0,e(t,n))};Array.isArray(t)||(t=[t]);for(var s=0;s<t.length;s++){var o=t[s].hasOwnProperty("body")?t[s].body:t[s];this.body.setOnCollideWith(o,n)}return this}i.d(e,{C$:function(){return h},Ih:function(){return o},iI:function(){return s},iu:function(){return l},op:function(){return r},xG:function(){return a},zh:function(){return n}})},551:function(t,e,i){function n(t,e){return this.origin.setTo(t,e),Phaser.Geom.Line.SetToAngle(this._ray,this.origin.x,this.origin.y,this.angle,this.rayRange),this.detectionRangeCircle.setTo(this.origin.x,this.origin.y,this.detectionRange),("matter"===this.bodyType&&this.collisionRange!==Phaser.Math.MAX_SAFE_INTEGER||"arcade"===this.bodyType)&&(this.collisionCircle.x=t,this.collisionCircle.y=e),this}i.d(e,{v:function(){return n}})},698:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(t){var e=[],i=new Phaser.Geom.Circle(this.origin.x,this.origin.y,this.collisionRange);if("matter"===this.bodyType)if(void 0===t){var s,o=n(t=this._raycaster.scene.matter.query.collides(this.body,this._raycaster.scene.matter.getMatterBodies()));try{for(o.s();!(s=o.n()).done;){var r=s.value,a=r.bodyA===this.body?r.bodyB:r.bodyA;this.testMatterOverlap(a)&&e.push(a)}}catch(x){o.e(x)}finally{o.f()}}else{Array.isArray(t)||(t=[t]);var h,l=n(t);try{for(l.s();!(h=l.n()).done;){var c=h.value;c!==this.body&&this.testMatterOverlap(c)&&e.push(c)}}catch(x){l.e(x)}finally{l.f()}}else{var u=!1;if(void 0===t?(t=this._raycaster.scene.physics.overlapCirc(this.origin.x,this.origin.y,this.collisionRange,!0,!0),u=!0):Array.isArray(t)||(t=[t]),u){var d,g=n(t);try{for(g.s();!(d=g.n()).done;){var y=d.value;if(y!==this.body){var p;p=y.isCircle?new Phaser.Geom.Circle(y.position.x+y.halfWidth,y.position.y+y.halfWidth,y.halfWidth):new Phaser.Geom.Rectangle(y.x,y.y,y.width,y.height),this.testArcadeOverlap(p)&&e.push(y.gameObject)}}}catch(x){g.e(x)}finally{g.f()}}else{var f,m=n(t);try{for(m.s();!(f=m.n()).done;){var b=f.value;if(void 0!==b.body){var v=void 0;if(b.body.isCircle){if(v=new Phaser.Geom.Circle(b.body.position.x+b.body.halfWidth,b.body.position.y+b.body.halfWidth,b.body.halfWidth),!Phaser.Geom.Intersects.CircleToCircle(i,v))continue}else if(v=new Phaser.Geom.Rectangle(b.body.x,b.body.y,b.body.width,b.body.height),!Phaser.Geom.Intersects.CircleToRectangle(i,v))continue;this.testArcadeOverlap(v)&&e.push(b)}}}catch(x){m.e(x)}finally{m.f()}}}return e}function r(t,e){var i,n,s;if(void 0!==t.bodyA&&void 0!==t.bodyB?(i=t.bodyA,n=t.bodyB):(i=t,n=e),void 0!==i._ray&&i._ray===this)s=n;else{if(void 0===n._ray||n._ray!==this)return!1;s=i}return this.overlap(s).length>0}function a(t){var e,i=n(this.slicedIntersections);try{for(i.s();!(e=i.n()).done;){var s=e.value;if(0==t.type?Phaser.Geom.Intersects.TriangleToCircle(s,t):Phaser.Geom.Intersects.RectangleToTriangle(t,s))return!0}}catch(o){i.e(o)}finally{i.f()}return!1}function h(t){var e;if("body"===t.type)e=t;else{if(void 0===t.body)return!1;e=t.body}var i,s=n(e.parts.length>1?e.parts.splice(1):e.parts);try{for(s.s();!(i=s.n()).done;){for(var o=i.value,r=o.vertices[0],a=1,h=o.vertices.length;a<h;a++){var l,c=o.vertices[a],u=new Phaser.Geom.Line(r.x,r.y,c.x,c.y),d=n(this.slicedIntersections);try{for(d.s();!(l=d.n()).done;){var g=l.value,y=Phaser.Geom.Intersects.TriangleToLine(g,u);if(y||(y=Phaser.Geom.Triangle.ContainsPoint(g,u.getPointA())),y||(y=Phaser.Geom.Triangle.ContainsPoint(g,u.getPointB())),y)return!0}}catch(v){d.e(v)}finally{d.f()}r=c}var p,f=new Phaser.Geom.Line(o.vertices[o.vertices.length-1].x,o.vertices[o.vertices.length-1].y,o.vertices[0].x,o.vertices[0].y),m=n(this.slicedIntersections);try{for(m.s();!(p=m.n()).done;){var b=p.value;if(Phaser.Geom.Intersects.TriangleToLine(b,f))return!0}}catch(v){m.e(v)}finally{m.f()}}}catch(v){s.e(v)}finally{s.f()}return!1}i.d(e,{EF:function(){return o},ZI:function(){return r},a_:function(){return a},nY:function(){return h}})},760:function(t,e,i){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Phaser.Math.MAX_SAFE_INTEGER;return this.rayRange=t,Phaser.Geom.Line.SetToAngle(this._ray,this.origin.x,this.origin.y,this.angle,this.rayRange),this}function s(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return this.detectionRange=t,this.detectionRangeCircle.setTo(this.origin.x,this.origin.y,this.detectionRange),this}function o(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Phaser.Math.MAX_SAFE_INTEGER,e=this.collisionRange==Phaser.Math.MAX_SAFE_INTEGER;if(this.collisionRange=t,this.collisionCircle.setRadius(this.collisionRange),"matter"===this.bodyType){if(this.collisionRange==Phaser.Math.MAX_SAFE_INTEGER){var i=this._raycaster.boundingBox;this._raycaster.scene.matter.body.set(this.body,{shape:{type:"rectangle",x:i.rectangle.centerX,y:i.rectangle.centerY,width:i.rectangle.width,height:i.rectangle.height,circleRadius:0}})}else e?this._raycaster.scene.matter.body.set(this.body,{shape:{type:"circle",x:this.collisionCircle.x,y:this.collisionCircle.y},circleRadius:this.collisionRange,isStatic:!1}):this.collisionCircle.setRadius(this.collisionRange);this._raycaster.scene.matter.body.set(this.body,"circleRadius",this.collisionRange)}else"arcade"===this.bodyType&&this.body.setCircle(this.collisionRange);return this}function r(t){var e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return!this.detectionRange||(e=i||("body"===t.type||"composite"===t.type?t.raycasterMap.getBoundingBox():t.data.get("raycasterMap").getBoundingBox()),!!Phaser.Geom.Intersects.CircleToRectangle(this.detectionRangeCircle,e))}i.d(e,{Bl:function(){return s},eq:function(){return r},o0:function(){return o},qL:function(){return n}})},689:function(t,e,i){function n(t,e){this._raycaster=e||!1,this.origin=new Phaser.Geom.Point,this._ray=new Phaser.Geom.Line,this.angle=0,this.cone=0,this.rayRange=Phaser.Math.MAX_SAFE_INTEGER,this.detectionRange=0,this.detectionRangeCircle=new Phaser.Geom.Circle,this.collisionRange=Phaser.Math.MAX_SAFE_INTEGER,this.ignoreNotIntersectedRays=!0,this.round=!1,this.autoSlice=!1,this.intersections=[],this.slicedIntersections=[],this.bodyType=!1,this._stats={method:"cast",rays:0,testedMappedObjects:0,hitMappedObjects:0,segments:0,time:0},this.graphics,this.config(t)}i.d(e,{R:function(){return n}}),n.prototype={config:i(807).$,getStats:i(838).G,setRay:i(26).n,setOrigin:i(551).v,setRayRange:i(760).qL,setAngle:i(822).S,setAngleDeg:i(822).O,setCone:i(582).M,setConeDeg:i(582).U,setDetectionRange:i(760).Bl,boundsInRange:i(760).eq,cast:i(974).w,castCircle:i(506).I,castCone:i(757).d,slice:i(691).d,setCollisionRange:i(760).o0,enablePhysics:i(181).z,overlap:i(698).EF,processOverlap:i(698).ZI,testArcadeOverlap:i(698).a_,testMatterOverlap:i(698).nY,setCollisionCategory:i(127).zh,setCollisionGroup:i(127).iI,setCollidesWith:i(127).Ih,setOnCollide:i(127).op,setOnCollideEnd:i(127).xG,setOnCollideActive:i(127).C$,setOnCollideWith:i(127).iu,drawDebug:i(882).s,destroy:i(487).z}},26:function(t,e,i){function n(t,e,i){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Phaser.Math.MAX_SAFE_INTEGER;return this.origin.setTo(t,e),this.angle=Phaser.Math.Angle.Normalize(i),this.rayRange=n,Phaser.Geom.Line.SetToAngle(this._ray,this.origin.x,this.origin.y,this.angle,this.rayRange),this.detectionRangeCircle.setTo(this.origin.x,this.origin.y,this.detectionRange),this}i.d(e,{n:function(){return n}})},691:function(t,e,i){function n(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.intersections,e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(!Array.isArray(t)){if(4!==t.type)return[];t=t.points}if(0===t.length)return[];for(var i=[],n=0,s=t.length-1;n<s;n++)i.push(new Phaser.Geom.Triangle(this.origin.x,this.origin.y,t[n].x,t[n].y,t[n+1].x,t[n+1].y));return e&&i.push(new Phaser.Geom.Triangle(this.origin.x,this.origin.y,t[0].x,t[0].y,t[t.length-1].x,t[t.length-1].y)),i}i.d(e,{d:function(){return n}})},838:function(t,e,i){function n(){return this._stats}i.d(e,{G:function(){return n}})},232:function(t,e,i){function n(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!i){if(Array.isArray(t)||(i=function(t,e){if(t){if("string"==typeof t)return s(t,e);var i={}.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?s(t,e):void 0}}(t))||e){i&&(t=i);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,h=!1;return{s:function(){i=i.call(t)},n:function(){var t=i.next();return a=t.done,t},e:function(t){h=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(h)throw r}}}}function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=Array(e);i<e;i++)n[i]=t[i];return n}function o(t){return(o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function r(t){if(this.version="0.10.11",this.scene,this.graphics,this.debugOptions={enabled:!1,maps:!0,rays:!0,graphics:{ray:65280,rayPoint:16711935,mapPoint:65535,mapSegment:255,mapBoundingBox:16711680}},this._stats={mappedObjects:{total:0,static:0,dynamic:0,rectangleMaps:0,polygonMaps:0,circleMaps:0,lineMaps:0,containerMaps:0,tilemapMaps:0,matterMaps:0}},this.boundingBox=!1,this.mappedObjects=[],this.dynamicMappedObjects=[],this.mapSegmentCount=0,void 0!==t){if(void 0===t.boundingBox&&void 0!==t.scene)if(void 0!==t.scene.physics)t.boundingBox=t.scene.physics.world.bounds;else if(void 0!==t.scene.matter){var e=t.scene.matter.world.walls;null!==e.top&&(t.boundingBox=new Phaser.Geom.Rectangle(e.top.vertices[3].x,e.top.vertices[3].y,e.bottom.vertices[1].x-e.top.vertices[3].x,e.bottom.vertices[1].y-e.top.vertices[3].y))}this.setOptions(t),(void 0===t.autoUpdate||t.autoUpdate)&&this.scene.events.on("update",this.update,this)}else this.scene.events.on("update",this.update,this);return this}i.d(e,{t:function(){return r}}),r.prototype={setOptions:function(t){return void 0!==t.scene&&(this.scene=t.scene,this.graphics=this.scene.add.graphics({lineStyle:{width:1,color:65280},fillStyle:{color:16711935}}),this.graphics.setDepth(999)),void 0!==t.debug&&!1!==t.debug&&(this.debugOptions.enabled=!0,"object"===o(t.debug)&&Object.assign(this.debugOptions,t.debug)),void 0!==t.mapSegmentCount&&(this.mapSegmentCount=t.mapSegmentCount),void 0!==t.objects&&this.mapGameObjects(t.objects),void 0!==t.boundingBox&&this.setBoundingBox(t.boundingBox.x,t.boundingBox.y,t.boundingBox.width,t.boundingBox.height),this},setBoundingBox:function(t,e,i,n){this.boundingBox={rectangle:new Phaser.Geom.Rectangle(t,e,i,n),points:[],segments:[]};var s=[new Phaser.Geom.Point(this.boundingBox.rectangle.left,this.boundingBox.rectangle.top),new Phaser.Geom.Point(this.boundingBox.rectangle.right,this.boundingBox.rectangle.top),new Phaser.Geom.Point(this.boundingBox.rectangle.right,this.boundingBox.rectangle.bottom),new Phaser.Geom.Point(this.boundingBox.rectangle.left,this.boundingBox.rectangle.bottom)];this.boundingBox.points=s;for(var o=0,r=this.boundingBox.points.length;o<r;o++)o+1<r?this.boundingBox.segments.push(new Phaser.Geom.Line(s[o].x,s[o].y,s[o+1].x,s[o+1].y)):this.boundingBox.segments.push(new Phaser.Geom.Line(s[o].x,s[o].y,s[0].x,s[0].y))},mapGameObjects:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};i.dynamic=e,i.segmentCount=void 0!==i.segmentCount?i.segmentCount:this.segmentCount,Array.isArray(t)||(t=[t]);var s,o=n(t);try{for(o.s();!(s=o.n()).done;){var r=s.value;if(!(this.mappedObjects.includes(r)||r.data&&r.data.get("raycasterMapNotSupported"))){var a={};for(var h in i)a[h]=i[h];a.object=r;var l=new this.Map(a,this);if(l.notSupported)l.destroy();else switch("body"===r.type||"composite"===r.type?r.raycasterMap=l:(r.data||r.setDataEnabled(),r.data.set("raycasterMap",l)),this.mappedObjects.push(r),r.type){case"Polygon":this._stats.mappedObjects.polygonMaps++;break;case"Arc":this._stats.mappedObjects.circleMaps++;break;case"Line":this._stats.mappedObjects.lineMaps++;break;case"Container":this._stats.mappedObjects.containerMaps++;break;case"StaticTilemapLayer":case"DynamicTilemapLayer":case"TilemapLayer":this._stats.mappedObjects.tilemapMaps++;break;case"MatterBody":this._stats.mappedObjects.matterMaps++;break;default:this._stats.mappedObjects.rectangleMaps++}}}}catch(c){o.e(c)}finally{o.f()}return this._stats.mappedObjects.total=this.mappedObjects.length,this._stats.mappedObjects.static=this._stats.mappedObjects.total-this.dynamicMappedObjects.length,this},removeMappedObjects:function(t){Array.isArray(t)||(t=[t]);var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var s=e.value,o=this.mappedObjects.indexOf(s);if(-1!==o)switch(this.mappedObjects.splice(o,1),(o=this.dynamicMappedObjects.indexOf(s))>=0&&this.dynamicMappedObjects.splice(o,1),"body"===s.type||"composite"===s.type?s.raycasterMap.destroy():s.data.get("raycasterMap").destroy(),s.type){case"Polygon":this._stats.mappedObjects.polygonMaps--;break;case"Arc":this._stats.mappedObjects.circleMaps--;break;case"Line":this._stats.mappedObjects.lineMaps--;break;case"Container":this._stats.mappedObjects.containerMaps--;break;case"StaticTilemapLayer":case"DynamicTilemapLayer":case"TilemapLayer":this._stats.mappedObjects.tilemapMaps--;break;case"MatterBody":this._stats.mappedObjects.matterMaps--;break;default:this._stats.mappedObjects.rectangleMaps--}}}catch(r){i.e(r)}finally{i.f()}return this._stats.mappedObjects.total=this.mappedObjects.length,this._stats.mappedObjects.dynamic=this.dynamicMappedObjects.length,this._stats.mappedObjects.static=this._stats.mappedObjects.total-this.dynamicMappedObjects.length,this},enableMaps:function(t){Array.isArray(t)||(t=[t]);var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var s=e.value,o=void 0;"body"===s.type||"composite"===s.type?o=s.raycasterMap:s.data&&(o=s.data.get("raycasterMap")),o&&(o.active=!0)}}catch(r){i.e(r)}finally{i.f()}return this},disableMaps:function(t){Array.isArray(t)||(t=[t]);var e,i=n(t);try{for(i.s();!(e=i.n()).done;){var s=e.value,o=void 0;"body"===s.type||"composite"===s.type?o=s.raycasterMap:s.data&&(o=s.data.get("raycasterMap")),o&&(o.active=!1)}}catch(r){i.e(r)}finally{i.f()}return this},update:function(){if(this.dynamicMappedObjects.length>0){var t,e=n(this.dynamicMappedObjects);try{for(e.s();!(t=e.n()).done;){var i=t.value,s=void 0;"body"===i.type||"composite"===i.type?s=i.raycasterMap:i.data&&(s=i.data.get("raycasterMap")),s&&s.active&&s.updateMap()}}catch(o){e.e(o)}finally{e.f()}}return this.debugOptions.enabled&&this.drawDebug(),this},createRay:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return new this.Ray(t,this)},getStats:function(){return this._stats},drawDebug:function(){if(void 0===this.graphics||!this.debugOptions.enabled)return this;if(this.graphics.clear(),!this.debugOptions.maps)return this;var t,e=n(this.mappedObjects);try{for(e.s();!(t=e.n()).done;){var i=t.value,s=void 0;if("body"===i.type||"composite"===i.type?s=i.raycasterMap:i.data&&(s=i.data.get("raycasterMap")),s){if(this.debugOptions.graphics.mapBoundingBox&&(this.graphics.lineStyle(1,this.debugOptions.graphics.mapBoundingBox),this.graphics.strokeRectShape(s.getBoundingBox())),this.debugOptions.graphics.mapSegment){this.graphics.lineStyle(1,this.debugOptions.graphics.mapSegment);var o,r=n(s.getSegments());try{for(r.s();!(o=r.n()).done;){var a=o.value;this.graphics.strokeLineShape(a)}}catch(u){r.e(u)}finally{r.f()}}if(this.debugOptions.graphics.mapPoint){this.graphics.fillStyle(this.debugOptions.graphics.mapPoint);var h,l=n(s.getPoints());try{for(l.s();!(h=l.n()).done;){var c=h.value;this.graphics.fillPoint(c.x,c.y,3)}}catch(u){l.e(u)}finally{l.f()}}}}}catch(u){e.e(u)}finally{e.f()}return this},destroy:function(){for(var t in this.removeMappedObjects(this.mappedObjects),this.graphics&&this.graphics.destroy(),this.scene&&this.scene.events.removeListener("update",null,this),this)delete this[t]}},r.prototype.Map=i(465).T,r.prototype.Ray=i(689).R}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}return i.d=function(t,e){for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i(781)}()),T.exports));class R extends s.Scene{constructor(){super("Cutscene"),e(this,"levelManager"),e(this,"cutsceneInfo"),e(this,"slideIndex"),e(this,"text"),e(this,"firstButton"),e(this,"secondButton"),e(this,"isTransition")}preload(){this.levelManager=new G,this.cutsceneInfo=this.levelManager.getCurrentCutsceneInfo(),this.load.image(this.getCutsceneBgName(),"assets/bg/"+this.getCutsceneIndex()+".jpg")}create(){this.slideIndex=0,this.cutsceneInfo=this.levelManager.getCurrentCutsceneInfo(),this.isTransition=!1,m(this).preloadGameSounds(),this.cameras.main.setBackgroundColor(v.BG_DARK),this.drawBackgroundImage(),this.drawCurrentSlide(),S(this,500),this.cutsceneInfo.index.startsWith("end")?m(this).playHeroic():m(this).playCutscene()}drawBackgroundImage(){const t=this.add.image(300,200,this.getCutsceneBgName());t.setDisplaySize(600,b),t.setScrollFactor(0)}getCurrentSlide(){return this.cutsceneInfo.cutscenes[this.slideIndex]}getCutsceneIndex(){return this.cutsceneInfo.index}getCutsceneBgName(){return"cs_bg_"+this.getCutsceneIndex()}nextSlide(){this.isTransition=!0,this.tweens.add({targets:[this.text,this.firstButton,this.secondButton],alpha:0,duration:1e3,ease:"Linear",onComplete:()=>{this.text.destroy(),this.firstButton.destroy(),this.secondButton&&this.secondButton.destroy(),this.slideIndex++,this.drawCurrentSlide(),this.isTransition=!1}})}drawCurrentSlide(){const t=this.getCurrentSlide();this.text=x(this,300,120,t.text);const e=t.buttons[0],i=t.buttons[1];i?(this.firstButton=this.createSlideButton(e,200),this.secondButton=this.createSlideButton(i,400)):this.firstButton=this.createSlideButton(e,300),this.text.alpha=0,this.firstButton.alpha=0,this.secondButton&&(this.secondButton.alpha=0),this.tweens.add({targets:[this.text,this.firstButton,this.secondButton],alpha:1,duration:1e3,ease:"Linear"})}createSlideButton(t,e){return P(this,e,320,t.text,(()=>{this.isTransition||(this.slideIndex==this.cutsceneInfo.cutscenes.length-1?(m(this).stopCutscene(),m(this).stopHeroic(),t.nextLevel?(this.levelManager.saveLevel(t.nextLevel),this.levelManager.launchCurrentLevelScene(this)):(this.levelManager.initClearSave(),w(this,5e3,(()=>{this.scene.stop("MainMenu"),this.scene.start("MainMenu")})))):this.nextSlide())}))}}const I={type:Phaser.WEBGL,width:600,height:b,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},backgroundColor:"#000000",scene:[L,A,R],physics:{default:"arcade",arcade:{debug:!1,gravity:{y:300,x:0}}},plugins:{scene:[{key:"PhaserRaycaster",plugin:O,mapping:"raycasterPlugin"}]},pixelArt:!0},E="./assets/",k=new FontFace("pixelizer","url("+E+"pixelizer.ttf) format('truetype')");document.fonts.add(k),k.load().then((()=>{const t=new FontFace("sonic","url("+E+"sonic.ttf) format('truetype')");document.fonts.add(t),t.load().then((()=>{setTimeout((()=>{new s.Game({...I,parent:"game-container"})}),0)}))}));
